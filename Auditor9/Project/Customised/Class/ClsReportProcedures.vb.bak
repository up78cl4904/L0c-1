
Public Class ClsReportProcedures

#Region "Danger Zone"
    Dim StrArr1() As String = Nothing, StrArr2() As String = Nothing, StrArr3() As String = Nothing, StrArr4() As String = Nothing, StrArr5() As String = Nothing

    Dim mGRepFormName As String = ""

    Dim WithEvents ReportFrm As ReportLayout.FrmReportLayout

    Public Property GRepFormName() As String
        Get
            GRepFormName = mGRepFormName
        End Get
        Set(ByVal value As String)
            mGRepFormName = value
        End Set
    End Property

#End Region

#Region "Common Reports Constant"
    Private Const CityList As String = "CityList"
    Private Const UserWiseEntryReport As String = "UserWiseEntryReport"
    Private Const UserWiseEntryTargetReport As String = "UserWiseEntryTargetReport"
#End Region

#Region "Reports Constant"
    Private Const SaleChallanReport As String = "SaleChallanReport"
    Private Const SaleInvoiceReport As String = "SaleInvoiceReport"
    Private Const PurchaseChallanReport As String = "PurchaseChallanReport"
    Private Const PurchaseInvoiceReport As String = "PurchaseInvoiceReport"
    Private Const PurchaseAdviseReport As String = "PurchaseAdviseReport"
    Private Const ItemExpiryReport As String = "ItemExpiryReport"
    Private Const PurchaseIndentReport As String = "PurchaseIndentReport"
    Private Const VATReports As String = "VATReports"
    Private Const PartyOutstandingReport As String = "PartyOutstandingReport"
    Private Const BillWiseProfitability As String = "BillWiseProfitability"
#End Region

#Region "Queries Definition"
    Dim mHelpCityQry$ = "Select 'o' As Tick, CityCode, CityName From City "
    Dim mHelpStateQry$ = "Select 'o' As Tick, State_Code, State_Desc From State "
    Dim mHelpUserQry$ = "Select 'o' As Tick, User_Name As Code, User_Name As [User] From UserMast "
    Dim mHelpSiteQry$ = "Select 'o' As Tick, Code, Name As [Site] From SiteMast Where " & AgL.PubSiteCondition("Code", AgL.PubSiteCode) & " "
    Dim mHelpItemQry$ = "Select 'o' As Tick, Code, Description As [Item] From Item "
    Dim mHelpItemGroupQry$ = "Select 'o' As Tick, Code, Description As [Item Group] From ItemGroup "
    Dim mHelpVendorQry$ = " Select 'o' As Tick,  H.SubCode As Code, Sg.DispName AS Vendor FROM Vendor H LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode "
    Dim mHelpTableQry$ = "Select 'o' As Tick, H.Code, H.Description AS [Table] FROM HT_Table H "
    Dim mHelpPaymentModeQry$ = "Select 'o' As Tick, '" & ClsMain.PaymentMode.Cash & "' As Code, '" & ClsMain.PaymentMode.Cash & "' As Description " & _
                                " UNION ALL " & _
                                " Select 'o' As Tick, '" & ClsMain.PaymentMode.Credit & "' As Code, '" & ClsMain.PaymentMode.Credit & "' As Description "
    Dim mHelpOutletQry$ = "Select 'o' As Tick, H.Code, H.Description AS [Table] FROM Outlet H "
    Dim mHelpStewardQry$ = "Select 'o' As Tick,  Sg.SubCode AS Code, Sg.DispName AS Steward FROM SubGroup Sg  "
    Dim mHelpPartyQry$ = " Select 'o' As Tick,  Sg.SubCode As Code, Sg.DispName AS Party FROM SubGroup Sg Where Sg.Nature In ('Customer','Supplier','Cash') "
    Dim mHelpAgentQry$ = " Select Sg.SubCode As Code, Sg.DispName AS Agent FROM SubGroup Sg Where Sg.MasterType = '" & ClsMain.MasterType.Agent & "' "
    Dim mHelpSaleOrderQry$ = " Select 'o' As Tick,  H.DocID AS Code, H.V_Type + '-' + H.ReferenceNo  FROM SaleOrder H "
    Dim mHelpSaleBillQry$ = " SELECT 'o' As Tick,DocId, ReferenceNo AS BillNo, V_Date AS Date FROM SaleChallan "
    Dim mHelpItemReportingGroupQry$ = "Select 'o' As Tick,I.Code,I.Description  AS ItemReportingGroup FROM ItemReportingGroup I "
#End Region

    Dim DsRep As DataSet = Nothing, DsRep1 As DataSet = Nothing, DsRep2 As DataSet = Nothing
    Dim mQry$ = "", RepName$ = "", RepTitle$ = "", OrderByStr$ = ""

#Region "Initializing Grid"
    Public Sub Ini_Grid()
        Try
            Dim I As Integer = 0
            Select Case GRepFormName
                Case SaleInvoiceReport, SaleChallanReport
                    ReportFrm.CreateHelpGrid("FromDate", "From Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubStartDate)
                    ReportFrm.CreateHelpGrid("ToDate", "To Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubEndDate)
                    ReportFrm.CreateHelpGrid("Report Type", "Report Type", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Summary' as Code, 'Summary' as Name Union All Select 'Month Wise Summary' as Code, 'Month Wise Summary' as Name Union All Select 'Party Wise Summary' as Code, 'Party Wise Summary' as Name Union All Select 'Agent Wise Summary' as Code, 'Agent Wise Summary' as Name Union All Select 'Agent-Item Wise Summary' as Code, 'Agent-Item Wise Summary' as Name Union All Select 'Item Wise Detail' as Code, 'Item Wise Detail' as Name", "Summary", , , , , False)
                    ReportFrm.CreateHelpGrid("Party", "Party", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpPartyQry)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)
                    ReportFrm.CreateHelpGrid("Site", "Site", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpSiteQry)
                    ReportFrm.CreateHelpGrid("VoucherType", "Voucher Type", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, FGetVoucher_TypeQry("SaleInvoice"))
                    ReportFrm.CreateHelpGrid("CashCredit", "Cash/Credit", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Cash' as Code, 'Cash' as Name Union All Select 'Credit' as Code, 'Credit' as Name Union All Select 'Both' as Code, 'Both' as Name", "Both", , , , , False)
                    ReportFrm.CreateHelpGrid("Agent", "Agent", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, mHelpAgentQry)
                    ReportFrm.CreateHelpGrid("Team/Individual", "Team/Individual", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Individual' as Code, 'Individual' as Name Union All Select 'Team' as Code, 'Team' as Name", "Team", , , , , False)

                Case PurchaseInvoiceReport, PurchaseChallanReport
                    ReportFrm.CreateHelpGrid("FromDate", "From Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubStartDate)
                    ReportFrm.CreateHelpGrid("ToDate", "To Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubEndDate)
                    ReportFrm.CreateHelpGrid("Report Type", "Report Type", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Summary' as Code, 'Summary' as Name Union All Select 'Month Wise Summary' as Code, 'Party Wise Summary' as Name Union All Select 'Party Wise Summary' as Code, 'Month Wise Summary' as Name Union All Select 'Item Wise Detail' as Code, 'Item Wise Detail' as Name", "Summary", , , , , False)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)
                    ReportFrm.CreateHelpGrid("Party", "Party", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpPartyQry)
                    ReportFrm.CreateHelpGrid("Site", "Site", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpSiteQry)
                    ReportFrm.CreateHelpGrid("VoucherType", "Voucher Type", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, FGetVoucher_TypeQry("PurchInvoice"))

                Case PurchaseAdviseReport
                    ReportFrm.CreateHelpGrid("AsOnDate", "As On Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubLoginDate)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)
                    ReportFrm.CreateHelpGrid("ItemGroup", "Item Group", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemGroupQry)
                    ReportFrm.CreateHelpGrid("Item ActiveInActive", "Item Active/InActive", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Active' As Code, 'Active' as Name Union All Select 'InActive' as Code, 'InActive' as Name Union All Select 'Both' as Code, 'Both' as Name", "Active")

                Case ItemExpiryReport
                    ReportFrm.CreateHelpGrid("AsOnDate", "Before Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubLoginDate)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)
                    ReportFrm.CreateHelpGrid("ItemGroup", "Item Group", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemGroupQry)
                    ReportFrm.CreateHelpGrid("Item ActiveInActive", "Item Active/InActive", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, "Select 'Active' As Code, 'Active' as Name Union All Select 'InActive' as Code, 'InActive' as Name Union All Select 'Both' as Code, 'Both' as Name", "Active")

                Case PurchaseIndentReport
                    ReportFrm.CreateHelpGrid("FromDate", "Order From Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubStartDate)
                    ReportFrm.CreateHelpGrid("ToDate", "Order Upto Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubEndDate)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)

                Case VATReports
                    mQry = "Select 'Annexure A' AS Code, 'Annexure A' AS Name "
                    mQry += "Union All Select 'Annexure A1' as Code, 'Annexure A1' AS Name "
                    mQry += "Union All Select 'Annexure B' as Code, 'Annexure B' as Name "
                    mQry += "Union All Select 'Annexure B1' as Code, 'Annexure B1' as Name "
                    mQry += "Union All Select 'Annexure C' as Code, 'Annexure C' as Name "
                    mQry += "Union All Select 'Return Of Tax' as Code, 'Return Of Tax' as Name "
                    mQry += "Union All Select 'Return Form 24' as Code, 'Return Form 24' as Name "
                    ReportFrm.CreateHelpGrid("FromDate", "Order From Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubStartDate)
                    ReportFrm.CreateHelpGrid("ToDate", "Order Upto Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubEndDate)
                    ReportFrm.CreateHelpGrid("Report Type", "Report Type", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.SingleSelection, mQry, "", , , , , False)

                Case PartyOutstandingReport
                    ReportFrm.CreateHelpGrid("As On Date", "As On Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubLoginDate)
                    ReportFrm.CreateHelpGrid("Party", "Party", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpPartyQry)

                Case BillWiseProfitability
                    ReportFrm.CreateHelpGrid("FromDate", "From Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubStartDate)
                    ReportFrm.CreateHelpGrid("ToDate", "To Date", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.DateType, "", AgL.PubEndDate)
                    ReportFrm.CreateHelpGrid("Party", "Party", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpPartyQry)
                    ReportFrm.CreateHelpGrid("Item", "Item", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemQry)
                    ReportFrm.CreateHelpGrid("Bill No", "Bill No", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpSaleBillQry)
                    ReportFrm.CreateHelpGrid("Item Reporting Group", "Item Reporting Group", ReportLayout.FrmReportLayout.FieldFilterDataType.StringType, ReportLayout.FrmReportLayout.FieldDataType.MultiSelection, mHelpItemReportingGroupQry)
            End Select
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub
#End Region

    Private Function FGetVoucher_TypeQry(ByVal TableName As String) As String
        FGetVoucher_TypeQry = " SELECT Distinct 'o' As Tick, H.V_Type AS Code, Vt.Description AS [Voucher Type] " & _
                                " FROM " & TableName & " H  " & _
                                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type "
    End Function

    Private Sub ObjRepFormGlobal_ProcessReport() Handles ReportFrm.ProcessReport
        Select Case mGRepFormName
            Case SaleChallanReport
                ProcSaleReport("SaleChallan", "SaleChallanDetail")

            Case SaleInvoiceReport
                ProcSaleReport("SaleInvoice", "SaleInvoiceDetail")

            Case PurchaseChallanReport
                ProcPurchaseInvoiceReport("PurchChallan", "PurchChallanDetail")

            Case PurchaseInvoiceReport
                ProcPurchaseInvoiceReport("PurchInvoice", "PurchInvoiceDetail")

            Case PurchaseAdviseReport
                ProcPurchaseAdviseReport()

            Case ItemExpiryReport
                ProcItemExpiryReport()

            Case PurchaseIndentReport
                ProcPurchaseIndentReport()

            Case VATReports
                ProcVatAnexureReports()

            Case PartyOutstandingReport
                ProcPartyOutstandingReport()

            Case BillWiseProfitability
                ProcBillWiseProfitabilty()

        End Select
    End Sub

    Public Sub New(ByVal mReportFrm As ReportLayout.FrmReportLayout)
        ReportFrm = mReportFrm
    End Sub

#Region "Sale Report"
    Private Sub ProcSaleReport(ByVal HeaderTable As String, ByVal LineTable As String)
        Try
            RepName = "Trade_SaleReport" : RepTitle = "Sale Report"


            Dim mCondStr$ = ""
            Dim strGrpFld As String = "''", strGrpFldHead As String = "''", strGrpFldDesc As String = "''"

            If ReportFrm.FGetText(2) = "Summary" Then
                RepName = "Trade_SaleReport" : RepTitle = "Sale Invoice Report"
            ElseIf ReportFrm.FGetText(2) = "Party Wise Summary" Then
                RepName = "Trade_SaleReportSummary" : RepTitle = "Sale Invoice Report (" & ReportFrm.FGetText(2) & ")"
                strGrpFld = "Party.Name"
                strGrpFldDesc = "Party.Name + ',' + IsNull(City.CityName,'')"
                strGrpFldHead = "'Party Name'"
            ElseIf ReportFrm.FGetText(2) = "Agent Wise Summary" Then
                RepName = "Trade_SaleReportSummary" : RepTitle = "Sale Invoice Report (" & ReportFrm.FGetText(2) & ")"
                strGrpFld = "Agent.Name"
                strGrpFldDesc = "Agent.Name + ',' + IsNull(City.CityName,'')"
                strGrpFldHead = "'AgentName'"
            ElseIf ReportFrm.FGetText(2) = "Agent-Item Wise Summary" Then
                RepName = "Trade_SaleReportAgentItemWiseSummary" : RepTitle = "Sale Invoice Report (" & ReportFrm.FGetText(2) & ")"
            ElseIf ReportFrm.FGetText(2) = "Month Wise Summary" Then
                RepName = "Trade_SaleReportSummary" : RepTitle = "Sale Invoice Report (" & ReportFrm.FGetText(2) & ")"
                strGrpFld = "Substring(convert(nvarchar,H.V_Date,11),0,6)"
                strGrpFldDesc = "Replace(SubString(Convert(VARCHAR,H.v_Date,6),4,6),' ','-')"
                strGrpFldHead = "'Month'"
            ElseIf ReportFrm.FGetText(2) = "Item Wise Detail" Then
                RepName = "Trade_ItemWiseSaleReport" : RepTitle = "Item Wise Sale Report"
            End If


            mCondStr = " Where 1 = 1 "

            If ReportFrm.FGetText(7) = "Cash" Then
                mCondStr = mCondStr & " AND Sg.Nature = 'Cash'"
            ElseIf ReportFrm.FGetText(7) = "Credit" Then
                mCondStr = mCondStr & " AND Sg.Nature <> 'Cash'"
            End If


            mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.BillToParty", 3)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 4)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.Site_Code", 5)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.V_Type", 6)

            If ReportFrm.FGetText(8) <> "All" Then
                If ReportFrm.FGetText(9) = "Team" Then
                    mCondStr += " And CharIndex('" & AgL.XNull(ReportFrm.FGetCode(8)) & "',H.Upline) > 0 "
                Else
                    mCondStr += " And H.Agent = '" & ReportFrm.FGetCode(8) & "'"
                End If
            End If

            mQry = " SELECT " & strGrpFld & " as GrpField, " & strGrpFldDesc & " as GrpFieldDesc, " & strGrpFldHead & " as GrpFieldHead, " & _
                    " H.DocID, H.V_Date, " & _
                    " Party.Name + ',' + IsNull(City.CityName,'') As SaleToPartyName , " & _
                    " Agent.Name + ',' + IsNull(City.CityName,'') As AgentName , " & _
                    " H.ReferenceNo,  " & _
                    " I.Description As ItemDesc, " & _
                    " L.Net_Amount, L.Qty, L.Unit " & _
                    " FROM " & HeaderTable & " H " & _
                    " Left Join " & LineTable & " L On H.DocID = L.DocID " & _
                    " Left Join Item I On L.Item = I.Code " & _
                    " Left Join Subgroup Party On H.SaleToParty = Party.SubCode " & _
                    " Left Join SubGroup Agent On H.Agent = Agent.SubCode " & _
                    " LEFT JOIN City On Party.CityCode = City.CityCode " & _
                    " LEFT JOIN Voucher_Type Vt On H.V_Type = Vt.V_Type " & mCondStr & OrderByStr
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

#Region "Purchase Invoice Report"
    Private Sub ProcPurchaseInvoiceReport(ByVal HeaderTable As String, ByVal LineTable As String)
        Dim strGrpFld As String = "''", strGrpFldHead As String = "''", strGrpFldDesc As String = "''"
        Try
            If ReportFrm.FGetText(2) = "Summary" Then
                RepName = "Trade_PurchaseReport" : RepTitle = "Purchase Invoice Report"
            ElseIf ReportFrm.FGetText(2) = "Party Wise Summary" Then
                RepName = "Trade_PurchaseReportSummary" : RepTitle = "Purchase Invoice Report (" & ReportFrm.FGetText(2) & ")"
                strGrpFld = "Sg.Name"
                strGrpFldDesc = "Sg.Name + ',' + IsNull(C.CityName,'')"
                strGrpFldHead = "'Party Name'"
            ElseIf ReportFrm.FGetText(2) = "Month Wise Summary" Then
                RepName = "Trade_PurchaseReportSummary" : RepTitle = "Purchase Invoice Report (" & ReportFrm.FGetText(2) & ")"
                strGrpFld = "Substring(convert(nvarchar,H.V_Date,11),0,6)"
                strGrpFldDesc = "Replace(SubString(Convert(VARCHAR,H.v_Date,6),4,6),' ','-')"
                strGrpFldHead = "'Month'"
            ElseIf ReportFrm.FGetText(2) = "Item Wise Detail" Then
                RepName = "Trade_ItemWisePurchaseReport" : RepTitle = "Item Wise Purchase Invoice Report"
            End If

            Dim mCondStr$ = ""
            mCondStr = " Where Vt.NCat = '" & AgTemplate.ClsMain.Temp_NCat.PurchaseInvoice & "' "

            mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 3)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.Vendor", 4)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.Site_Code", 5)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.V_Type", 6)

            mQry = " SELECT " & strGrpFld & " as GrpField, " & strGrpFldDesc & " as GrpFieldDesc, " & strGrpFldHead & " as GrpFieldHead, " & _
                        " L.DocId, L.Qty, L.Unit, L.Net_Amount, " & _
                        " I.Description AS ItemDesc, H.V_Date, H.ReferenceNo, Sg.DispName + ',' + IsNull(C.CityName,'') As VendorName, L.Remark " & _
                        " FROM " & LineTable & " L " & _
                        " LEFT JOIN " & HeaderTable & " H ON L.DocId = H.DocId " & _
                        " LEFT JOIN Voucher_Type Vt On H.V_Type = Vt.V_Type " & _
                        " LEFT JOIN Item I ON L.Item = I.Code " & _
                        " LEFT JOIN SubGroup Sg On H.Vendor = Sg.SubCode " & _
                        " LEFT JOIN City C On Sg.CityCode = C.CityCode " & mCondStr

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

#Region "Purchase Advise Report"
    Private Sub ProcPurchaseAdviseReport()
        Try
            Dim mCondStr$ = ""
            Dim strGrpFld As String = "''", strGrpFldHead As String = "''", strGrpFldDesc As String = "''"

            RepName = "Med_PurchaseAdviseReport" : RepTitle = "Purchase Advise Report"


            mCondStr = " Where 1 = 1 "
            mCondStr = mCondStr & " AND L.V_Date <= '" & ReportFrm.FGetText(0) & "' "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 1)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("I.ItemGroup", 2)

            If ReportFrm.FGetText(3) <> "Both" Then
                mCondStr = mCondStr & " And I.Status = '" & ReportFrm.FGetText(3) & "'"
            End If

            mQry = " SELECT L.Item, Max(I.Description) AS ItemDesc, Max(I.ReorderLevel) AS ReorderLevel, " & _
                    " IsNull(Sum(L.Qty_Rec),0) - IsNull(Sum(L.Qty_Iss),0) AS StockQty " & _
                    " FROM Stock L " & _
                    " LEFT JOIN Item  I ON L.Item = I.Code " & mCondStr & _
                    " GROUP BY L.Item " & _
                    " HAVING(IsNull(Sum(L.Qty_Rec), 0) - IsNull(Sum(L.Qty_Iss), 0) <= Max(I.ReorderLevel)) "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

#Region "Item Expiry Report"
    Private Sub ProcItemExpiryReport()
        Try
            Dim mCondStr$ = ""
            Dim strGrpFld As String = "''", strGrpFldHead As String = "''", strGrpFldDesc As String = "''"

            RepName = "Med_ItemExpiryReport" : RepTitle = "Item Expiry Report"

            mCondStr = " Where 1 = 1 "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 1)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("I.ItemGroup", 2)

            If ReportFrm.FGetText(3) <> "Both" Then
                mCondStr = mCondStr & " And I.Status = '" & ReportFrm.FGetText(3) & "'"
            End If

            mQry = " SELECT L.ReferenceDocID, L.ReferenceDocIDSr, Max(I.Description) As ItemDesc, " & _
                    " IsNull(Sum(L.Qty_Rec),0) - IsNull(Sum(L.Qty_Iss),0) AS StockQty, " & _
                    " Max(L.ExpiryDate) As ExpiryDate " & _
                    " FROM Stock L  " & _
                    " LEFT JOIN Item I ON L.Item = I.Code " & mCondStr & _
                    " GROUP BY L.ReferenceDocID, L.ReferenceDocIDSr " & _
                    " HAVING IsNull(Sum(L.Qty_Rec), 0) - IsNull(Sum(L.Qty_Iss), 0) > 0 " & _
                    " And Max(L.ExpiryDate) <= '" & ReportFrm.FGetText(0) & "' "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

#Region "Purchase Indent Report"
    Private Sub ProcPurchaseIndentReport()
        Try
            RepName = "Med_PurchaseIndentReport" : RepTitle = "Purhcase Indent Report"

            Dim mCondStr$ = ""

            mCondStr = " Where 1=1 "
            mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 2)

            mQry = " SELECT H.V_Date, I.Description As ItemDesc, IsNull(VStock.CurrentStock,0) As StockQty " & _
                    " FROM PurchIndent H  " & _
                    " LEFT JOIN PurchIndentDetail L ON H.DocID = L.DocId " & _
                    " LEFT JOIN ( " & _
                    "   Select S.Item, IsNull(Sum(S.Qty_Rec),0) - IsNull(Sum(S.Qty_Iss),0) As CurrentStock " & _
                    "   From Stock S Group By S.Item " & _
                    " ) As VStock On L.Item = VStock.Item " & _
                    " LEFT JOIN Item I ON L.Item = I.Code " & mCondStr

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

#Region "Vat Anexure Reports"
    Private Sub ProcVatAnexureReports()
        Dim SubTitle$ = ""
        Dim GroupHeaderTitle1$ = "", GroupHeaderTitle2$ = ""
        Dim IsReturn As Integer = 0
        Dim AssessmentYear$ = ""
        Try
            Dim mCondStr$ = ""

            If ReportFrm.FGetText(2) = "" Then
                MsgBox("Select Report Type First...!", MsgBoxStyle.Information)
                Exit Sub
            End If

            If AgL.StrCmp(ReportFrm.FGetText(2), "Annexure A") Then
                RepName = "Vat_Annexure_A" : RepTitle = "Annexure A" : SubTitle = "List of Purchases made against tax invoice"
                GroupHeaderTitle1 = "Purchase in Own Account" : GroupHeaderTitle2 = "Purchase in Commission Account"
                IsReturn = 0
                mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'"
                mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
                mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
                mCondStr = mCondStr & " AND H.TinNo Is Not Null "
                mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Annexure A1") Then
                RepName = "Vat_Annexure_A" : RepTitle = "Annexure A1" : SubTitle = "List of Purchases Return"
                GroupHeaderTitle1 = "Purchase in Own Account" : GroupHeaderTitle2 = "Purchase in Commission Account"
                IsReturn = 1
                mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'"
                mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
                mCondStr = mCondStr & " AND IsNull(H.Qty,0) < 0  "
                mCondStr = mCondStr & " AND H.TinNo Is Not Null "
                mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Annexure B") Then
                RepName = "Vat_Annexure_B" : RepTitle = "Annexure B" : SubTitle = "List of Sale made against tax invoice"
                GroupHeaderTitle1 = "Sale in Own Account" : GroupHeaderTitle2 = "Sale in Commission Account"
                IsReturn = 0
                mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'"
                mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
                mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
                mCondStr = mCondStr & " AND H.TinNo Is Not Null "
                mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Annexure B1") Then
                RepName = "Vat_Annexure_B" : RepTitle = "Annexure B1" : SubTitle = "List of Sales Return"
                GroupHeaderTitle1 = "Details of Sale Returned VAT Goods" : GroupHeaderTitle2 = "Details of Sale Returned NON-VAT Goods"
                IsReturn = 1
                mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'"
                mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
                mCondStr = mCondStr & " AND IsNull(H.Qty,0) < 0  "
                mCondStr = mCondStr & " AND H.TinNo Is Not Null "
                mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Annexure C") Then
                RepName = "Vat_Annexure_C" : RepTitle = "Annexure C" : SubTitle = ""
                GroupHeaderTitle1 = "Purchase in Own Account" : GroupHeaderTitle2 = ""
                IsReturn = 0
                mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'"
                mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
                mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
                mCondStr = mCondStr & " AND H.FormNo Is Not Null  "
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Return Of Tax") Then

            End If

            mQry = " Select cyear From Company Where Comp_Code = '" & AgL.PubCompCode & "' "
            AssessmentYear = AgL.XNull(AgL.Dman_Execute(mQry, AgL.GCn).ExecuteScalar)

            mQry = " SELECT 1 As Serial, '" & GroupHeaderTitle1 & "' As Title, H.DocId, H.Sr, H.V_Type, H.V_Date, H.SubCode, H.TINNo, " & _
                    " H.RecId, H.Item, Abs(H.Qty) As Qty, H.Unit, " & _
                    " Abs(H.Sales_Tax_Taxable_Amt) As Sales_Tax_Taxable_Amt, Abs(H.Sales_Tax_Per) As Sales_Tax_Per, Abs(H.Sales_Tax) As Sales_Tax, Abs(H.Additional_Sales_Tax_Per) As Additional_Sales_Tax_Per, Abs(H.Additional_Sales_Tax) As Additional_Sales_Tax, Abs(H.Net_Amount) As Net_Amount,  " & _
                    " Sg.DispName AS PartyName, I.VatCommodityCode, V.ManualCode AS VatCommodityManualCode, " & _
                    " Abs(H.Sales_Tax_Taxable_Amt) + Abs(H.Sales_Tax) + Abs(H.Additional_Sales_Tax) As TotalAmount, " & _
                    " '" & SubTitle & "' As SubTitle, " & IsReturn & " As IsReturn, H.FormNo As FormNo, '" & AssessmentYear & "' As AssessmentYear, '" & ReportFrm.FGetText(1) & "' As TaxPeriodEndDate    " & _
                    " FROM View_Vat H With (NoLock) " & _
                    " LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description " & _
                    " LEFT JOIN SubGroup Sg With (NoLock) ON H.SubCode = Sg.SubCode " & _
                    " LEFT JOIN Item I With (NoLock) ON H.Item = I.Code  " & _
                    " LEFT JOIN VatCommodityCode V With (NoLock) ON I.VatCommodityCode = V.Code " & _
                    " LEFT JOIN Voucher_Type Vt With (NoLock) On H.V_Type = Vt.V_Type " & mCondStr

            If GroupHeaderTitle2 <> "" Then
                mQry += " UNION ALL "

                mQry += " SELECT 2 As Serial, '" & GroupHeaderTitle2 & "' As Title, Null As DocId, Null As Sr, Null As V_Type, Null As V_Date, Null As SubCode, Null As TINNo, Null As RecId, Null As Item, Null As Qty, Null As Unit, " & _
                        " Null As Sales_Tax_Taxable_Amt, Null As Sales_Tax_Per, Null As Sales_Tax, Null As Additional_Sales_Tax_Per, Null As Additional_Sales_Tax, Null As Net_Amount,  " & _
                        " Null AS PartyName, Null As VatCommodityCode, Null As  VatCommodityManualCode, " & _
                        " Null  As TotalAmount  ,'" & SubTitle & "' As SubTitle, " & IsReturn & " As IsReturn, Null As FormNo, '" & AssessmentYear & "' As AssessmentYear, '" & ReportFrm.FGetText(1) & "' As TaxPeriodEndDate         "

            End If

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            If AgL.StrCmp(ReportFrm.FGetText(2), "Return Of Tax") Then
                FWriteTaxReturn(DsRep)
            ElseIf AgL.StrCmp(ReportFrm.FGetText(2), "Return Form 24") Then
                Dim xlObject As Excel.Application = Nothing
                Dim xlWB As Excel.Workbook = Nothing
                Dim xlSh As Excel.Worksheet = Nothing

                xlObject = New Excel.Application()
                xlObject.AlertBeforeOverwriting = False
                xlObject.DisplayAlerts = False

                ''This Adds a new woorkbook, you could open the workbook from file also
                xlWB = xlObject.Workbooks.Add(Type.Missing)
                xlWB.SaveAs(My.Application.Info.DirectoryPath + "\Reports\Vat Reports\" + "ReturnForm24.xls", Reflection.Missing.Value, Reflection.Missing.Value, Reflection.Missing.Value, Reflection.Missing.Value, Reflection.Missing.Value, _
                Excel.XlSaveAsAccessMode.xlNoChange, Reflection.Missing.Value, Reflection.Missing.Value, Reflection.Missing.Value, Reflection.Missing.Value)


                xlWB.Sheets("Sheet1").Select() : xlWB.Sheets("Sheet1").Name = "Main_Form"
                FWriteMainForm(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(1)) : xlWB.Sheets("Sheet2").Select() : xlWB.Sheets("Sheet2").Name = "Vat_Non_Vat"
                FWriteVatNonVat(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(2)) : xlWB.Sheets("Sheet3").Select() : xlWB.Sheets("Sheet3").Name = "Tax_Detail_Sale"
                FWriteTaxDetailSale(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(3)) : xlWB.Sheets("Sheet4").Select() : xlWB.Sheets("Sheet4").Name = "Tax_Detail_Purchase"
                FWriteTaxDetailPurchase(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(4)) : xlWB.Sheets("Sheet5").Select() : xlWB.Sheets("Sheet5").Name = "Vat_Bank_Detail"
                FWriteVatBankDetail(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(5)) : xlWB.Sheets("Sheet6").Select() : xlWB.Sheets("Sheet6").Name = "Form24_Annexure_A"
                FWriteForm24_Annexure_A(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(6)) : xlWB.Sheets("Sheet7").Select() : xlWB.Sheets("Sheet7").Name = "Form24_Annexure_A1"
                FWriteForm24_Annexure_A1(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(7)) : xlWB.Sheets("Sheet8").Select() : xlWB.Sheets("Sheet8").Name = "Form24_Annexure_A2"
                FWriteForm24_Annexure_A2(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(8)) : xlWB.Sheets("Sheet9").Select() : xlWB.Sheets("Sheet9").Name = "Form24_Annexure_B"
                FWriteForm24_Annexure_B(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(9)) : xlWB.Sheets("Sheet10").Select() : xlWB.Sheets("Sheet10").Name = "Form24_Annexure_B1"
                FWriteForm24_Annexure_B1(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(10)) : xlWB.Sheets("Sheet11").Select() : xlWB.Sheets("Sheet11").Name = "Form24_CommAgent"
                FWriteCommAgent(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(11)) : xlWB.Sheets("Sheet12").Select() : xlWB.Sheets("Sheet12").Name = "Form24_Annexure_C"
                FWriteForm24_Annexure_C(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(12)) : xlWB.Sheets("Sheet13").Select() : xlWB.Sheets("Sheet13").Name = "Form24_Annexure_D"
                FWriteForm24_Annexure_D(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(13)) : xlWB.Sheets("Sheet14").Select() : xlWB.Sheets("Sheet14").Name = "Form24_Annexure_E"
                FWriteForm24_Annexure_E(DsRep, xlObject, xlWB)
                xlWB.Worksheets.Add(After:=xlWB.Worksheets(14)) : xlWB.Sheets("Sheet15").Select() : xlWB.Sheets("Sheet15").Name = "Form24_Annexure_F"
                FWriteForm24_Annexure_F(DsRep, xlObject, xlWB)

                'xlWB.Sheets("Sheet1").Select()
                xlObject.Visible = True
            Else
                ReportFrm.PrintReport(DsRep, RepName, RepTitle)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

    'Private Sub FWriteTaxReturn(ByVal DsTemp As DataSet)
    '    Dim ErrorMessage As String = String.Empty
    '    Dim OExcelHandler As New ExcelHandler()


    '    Dim PurchaseInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NOT NULL "
    '    Dim PurchaseInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NULL "
    '    Dim PurchaseOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
    '    Dim PurchaseOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

    '    Dim TotalPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
    '    Dim TotalPurchaseReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

    '    Dim NetAmtOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
    '    Dim GrandTotalOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

    '    Dim TurnOverOfPurchaseOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
    '    Dim TurnOverOfPurchaseFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
    '    Dim TurnOverOfPurchaseTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

    '    Dim TotalSalesTaxVatOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
    '    Dim TotalSalesTaxVatFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
    '    Dim TotalSalesTaxVatTwelvePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

    '    Dim TotalAddSalesTaxPointFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
    '    Dim TotalAddSalesTaxOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

    '    Dim TotalSalesAndAddSalesTaxOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

    '    Dim TotalTurnOverOfPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "



    '    Dim SaleInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "' And H.TINNo IS NOT NULL "
    '    Dim SaleInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'   And H.TINNo IS NULL"
    '    Dim SaleOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
    '    Dim SaleOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0  And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

    '    Dim TotalSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
    '    Dim TotalSaleReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

    '    Dim NetAmtOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
    '    Dim GrandTotalOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

    '    Dim TurnOverOfSaleOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
    '    Dim TurnOverOfSaleFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
    '    Dim TurnOverOfSaleTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

    '    Dim TotalSalesTaxVatOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
    '    Dim TotalSalesTaxVatFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
    '    Dim TotalSalesTaxVatTwelvePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

    '    Dim TotalAddSalesTaxPointFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
    '    Dim TotalAddSalesTaxOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

    '    Dim TotalSalesAndAddSalesTaxOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

    '    Dim TotalTurnOverOfSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "

    '    Dim TotalTax$ = " SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category In ('" & ClsMain.Voucher_Category.Sale & "','" & ClsMain.Voucher_Category.Purchase & "')  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

    '    Dim NetTax$ = " Select " & _
    '            " Str((SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0) " & _
    '            " - (SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0),15,2)   "

    '    Try
    '        mQry = " SELECT '                                  UPVAT - XXIV'"
    '        mQry += "UNION ALL" & " SELECT '           Department of Commercial Taxes,Government of Utter Pradesh'"
    '        mQry += "UNION ALL" & " SELECT '                    [See Rule-45(2) of the UPVAT Rules,2008]'"
    '        mQry += "UNION ALL" & " SELECT '                    Return of Tax Period - monthly/quarterly'"
    '        mQry += "UNION ALL" & " SELECT '1. Assessment Year                    : " & AgL.PubStartDate & " - " & AgL.PubEndDate & "'"
    '        mQry += "UNION ALL" & " SELECT '2. Tax Period                         : " & ReportFrm.FGetText(0) & " - " & ReportFrm.FGetText(1) & "'"
    '        mQry += "UNION ALL" & " SELECT '3. Designation of Assessing Authority :'"
    '        mQry += "UNION ALL" & " SELECT '4. Name of Circle / Sector            :'"
    '        mQry += "UNION ALL" & " SELECT '5. Name & Address of Dealer           : " & AgL.PubCompName & "'"
    '        mQry += "UNION ALL" & " SELECT '                                      : " & AgL.PubCompAdd1 & "'"
    '        mQry += "UNION ALL" & " SELECT '                                      : " & AgL.PubCompAdd2 & "'"
    '        mQry += "UNION ALL" & " SELECT '6. Taxpayer`s Indentification Number  : " & AgL.PubCompTIN & "'"
    '        mQry += "UNION ALL" & " SELECT '7.   Details of Purchase [in Rs.]'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  a. Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     i.  Purchase in own a/c against tax invoice   :' + (" & PurchaseInOwnAcAgainstTaxInvoice & ")"
    '        mQry += "UNION ALL" & " SELECT '         (Annexure-A Part I)                       :'"
    '        mQry += "UNION ALL" & " SELECT '     ii. Purchase in own A/c from person other than:' + (" & PurchaseInOwnAcFromNonRegisteredDealer & ")"
    '        mQry += "UNION ALL" & " SELECT '         registered dealer                         :'"
    '        mQry += "UNION ALL" & " SELECT '     iii.Purchase of exempted goods                :' + (" & PurchaseOfExcemptGoods & ")"
    '        mQry += "UNION ALL" & " SELECT '     iv. Purchase from Ex.U.P.                     :' + (" & PurchaseOfExUp & ")"
    '        mQry += "UNION ALL" & " SELECT '     v.  Purchase in Principal A/c                 :'"
    '        mQry += "UNION ALL" & " SELECT '         (a) U.P.Principal                         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '         (a-i)  Principle against tax invoice      :'"
    '        mQry += "UNION ALL" & " SELECT '                (Annexure-A Part II)               :'"
    '        mQry += "UNION ALL" & " SELECT '         (a-ii) Other Purchase                     :'"
    '        mQry += "UNION ALL" & " SELECT '         (b) Ex.U.P.Principal                      :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     vi. Any other Purchase                        :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '                                           Total   :' + (" & TotalPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     vii.Less - Purchase Return (annexure-A1)      :' + (" & TotalPurchaseReturn & ")"
    '        mQry += "UNION ALL" & " SELECT '     viii. Net amount of purchase                  :' + (" & NetAmtOfPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  b. Non Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     i.  Purchase from registered dealers          :'"
    '        mQry += "UNION ALL" & " SELECT '     ii. Purchase from unregistered                :'"
    '        mQry += "UNION ALL" & " SELECT '     iii.Purchase of exempted goods                :'"
    '        mQry += "UNION ALL" & " SELECT '     iv. Purchase from Ex.U.P.                     :'"
    '        mQry += "UNION ALL" & " SELECT '     v.  Purchase in Principal A/c                 :'"
    '        mQry += "UNION ALL" & " SELECT '         (a) U.P.Principal                         :'"
    '        mQry += "UNION ALL" & " SELECT '         (a-i)  Principle against tax invoice      :'"
    '        mQry += "UNION ALL" & " SELECT '                (Annexure-A Part II)               :'"
    '        mQry += "UNION ALL" & " SELECT '         (a-ii) Other Purchase                     :'"
    '        mQry += "UNION ALL" & " SELECT '         (b) Ex.U.P.Principal                      :'"
    '        mQry += "UNION ALL" & " SELECT '     vi. Any other Purchase                        :'"
    '        mQry += "UNION ALL" & " SELECT '                                           Total   :'"
    '        mQry += "UNION ALL" & " SELECT '     vii.Less - Purchase Return (annexure-A1)      :'"
    '        mQry += "UNION ALL" & " SELECT '     viii. Net amount of purchase                  :'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                     Grand Total   :' + (" & GrandTotalOfPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  c. Capital Goods Purchased from with the state'"
    '        mQry += "UNION ALL" & " SELECT '     i.  Purchase against tax invoice Annexure A-2 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     ii. Purchase from unregistered                :'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                           Total   :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  d. Purchase through commission agent for which'"
    '        mQry += "UNION ALL" & " SELECT '     certificate in form VI has been received'"
    '        mQry += "UNION ALL" & " SELECT 'S.No.  Certificate No.       Date       Value of goods   Amout of Tax'"
    '        mQry += "UNION ALL" & " SELECT '1.'"
    '        mQry += "UNION ALL" & " SELECT '2.'"
    '        mQry += "UNION ALL" & " SELECT '3.'"
    '        mQry += "UNION ALL" & " SELECT '                             Total   :'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '8.   Computation of tax on purchase'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '     Sl.No.   Rate of Tax      Commodity      Turnover of Purchase      Tax'"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '              Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     i.            1 %                       :' + (" & TurnOverOfPurchaseOnePer & ")  + ' :' +           (" & TotalSalesTaxVatOnePerOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     ii.           5 %                       :' + (" & TurnOverOfPurchaseFivePer & ") + ' :' +           (" & TotalSalesTaxVatFivePerOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     iii.         12.5 %                     :' + (" & TurnOverOfPurchaseTwelvePer & ") + ' :' +           (" & TotalSalesTaxVatTwelvePerOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     Additional Tax'"
    '        mQry += "UNION ALL" & " SELECT '     iv.          .5 %                       :                :' + (" & TotalAddSalesTaxPointFivePerOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     v.            1 %                       :                :' + (" & TotalAddSalesTaxOnePerOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                Total        :' + (" & TotalTurnOverOfPurchase & ") + ' :' +           (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '              Non Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     vi.          20 %                       :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     vii.         32.5 %                     :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     viii.        ____ %                     :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                Total        :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                          Grand Total        :' + (" & GrandTotalOfPurchase & ") + ' :' +        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '9.   Details of Sale'"
    '        mQry += "UNION ALL" & " SELECT '  a. Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '     i.   Turnover of sale in own a/c against tax  :' + (" & SaleInOwnAcAgainstTaxInvoice & ")"
    '        mQry += "UNION ALL" & " SELECT '          invoice (annexure-B Part-1)              :'"
    '        mQry += "UNION ALL" & " SELECT '     ii.  Turnover of sale in own a/c other than in:' + (" & SaleInOwnAcFromNonRegisteredDealer & ")"
    '        mQry += "UNION ALL" & " SELECT '          column-i                                 :'"
    '        mQry += "UNION ALL" & " SELECT '     iii. Turnover of sale of exempted goods       :' + (" & SaleOfExcemptGoods & ")"
    '        mQry += "UNION ALL" & " SELECT '     iv.  Sale in Principal`s A/c                  :'"
    '        mQry += "UNION ALL" & " SELECT '          (a)  U.P.Principal                       :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '          (a-i) Sales ag.tax invoice Annx-B Part-II:'"
    '        mQry += "UNION ALL" & " SELECT '          (a-ii)Other Sales                        :'"
    '        mQry += "UNION ALL" & " SELECT '          (b)  Ex.U.P.Pricipal                     :' + (" & SaleOfExUp & ")"
    '        mQry += "UNION ALL" & " SELECT '     v.   Interstate sale against form `C`         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     vi.  Interstate sale without form `C`         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     vii. Sale in course of export out of India    :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     viii Sale in course of import                 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     ix.  Sale outside state                       :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     x.   Consignment Sale                         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     xi.  Any other sale                           :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '                                           Total   :' + (" & TotalSale & ")"
    '        mQry += "UNION ALL" & " SELECT '     xii. Less - sales return (annexure B-1)       :' + (" & TotalSaleReturn & ")"
    '        mQry += "UNION ALL" & " SELECT '     xiii.Net amount of sales                      :' + (" & NetAmtOfSale & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  b. Non Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '     i.   Taxable turnover of sale                 :'"
    '        mQry += "UNION ALL" & " SELECT '     ii.  Exempted turnover of sale                :'"
    '        mQry += "UNION ALL" & " SELECT '     iii. Tax paid turnover of goods               :'"
    '        mQry += "UNION ALL" & " SELECT '     iv.  Sale in Principal`s A/c                  :'"
    '        mQry += "UNION ALL" & " SELECT '          (a)  U.P.Principal                       :'"
    '        mQry += "UNION ALL" & " SELECT '          (a-i) Sales ag.tax invoice Annx-B Part-II:'"
    '        mQry += "UNION ALL" & " SELECT '          (a-ii)Other Sales                        :'"
    '        mQry += "UNION ALL" & " SELECT '          (b)  Ex.U.P.Pricipal                     :'"
    '        mQry += "UNION ALL" & " SELECT '     v.   Any other Sale                           :'"
    '        mQry += "UNION ALL" & " SELECT '                                           Total   :'"
    '        mQry += "UNION ALL" & " SELECT '     vi.  Less - sales return (annexure B-1)       :'"
    '        mQry += "UNION ALL" & " SELECT '     vii. Net amount of sales                      :'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                     Grand Total   :' + (" & GrandTotalOfSale & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '  c. Sales through commission agent for which in form V has'"
    '        mQry += "UNION ALL" & " SELECT '     been received'"
    '        mQry += "UNION ALL" & " SELECT 'S.No.  Certificate No.       Date       Value of goods   Amout of Tax'"
    '        mQry += "UNION ALL" & " SELECT '1.'"
    '        mQry += "UNION ALL" & " SELECT '2.'"
    '        mQry += "UNION ALL" & " SELECT '3.'"
    '        mQry += "UNION ALL" & " SELECT '                             Total   :'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '10.  Computation of tax on sale'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '     Sl.No.   Rate of Tax      Commodity             Sale Amount        Tax'"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '              Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     i.            1 %                       :' + (" & TurnOverOfSaleOnePer & ")  + ' :' +           (" & TotalSalesTaxVatOnePerOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '     ii.           5 %                       :' + (" & TurnOverOfSaleFivePer & ") + ' :' +           (" & TotalSalesTaxVatFivePerOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '     iii.         12.5 %                     :' + (" & TurnOverOfSaleTwelvePer & ") + ' :' +           (" & TotalSalesTaxVatTwelvePerOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '     Additional Tax'"
    '        mQry += "UNION ALL" & " SELECT '     iv.          .5 %                       :                :' + (" & TotalAddSalesTaxPointFivePerOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '     v.            1 %                       :                :' + (" & TotalAddSalesTaxOnePerOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                Total        :' + (" & TotalTurnOverOfSale & ") + ' :' +           (" & TotalSalesAndAddSalesTaxOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '              Non Vat Goods'"
    '        mQry += "UNION ALL" & " SELECT '     i.           20 %                       :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     ii.          32.5 %                     :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '     iii.         ____ %                     :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                Total        :           0.00 :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                          Grand Total        :      ' + (" & GrandTotalOfSale & ") + ':' +        (" & TotalSalesAndAddSalesTaxOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '11. Installment of compounding scheme,if any :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '12. Amount of T.D.S.                         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '13. Tax Payable'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '    i.  Tax on Purchase                      :' + (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '    ii. Tax on Sale                          :' + (" & TotalSalesAndAddSalesTaxOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '    iii.Installment of compounding scheme    :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '    iv. T.D.S.Amount                         :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                       Total :' + (" & TotalTax & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '14. Detail of ITC'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '    i.  ITC brought forward from previous    :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '    ii. ITC earned during the tax period     :'"
    '        mQry += "UNION ALL" & " SELECT '     a. On purchase made in own account      :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '     b. On purc.made through purchasing      :'"
    '        mQry += "UNION ALL" & " SELECT '        commission agent against in form VI  :'"
    '        mQry += "UNION ALL" & " SELECT '     c. Installment of ITC on opening stock  :'"
    '        mQry += "UNION ALL" & " SELECT '        due in the tax period                :'"
    '        mQry += "UNION ALL" & " SELECT '     d. Installment of ITC on capital goods  :'"
    '        mQry += "UNION ALL" & " SELECT '        due in the tax period                :'"
    '        mQry += "UNION ALL" & " SELECT '     e. ITC reversed during the tax period   :'"
    '        mQry += "UNION ALL" & " SELECT '     f. Admissible ITC in the tax period     :'"
    '        mQry += "UNION ALL" & " SELECT '    iii. a. Adjustment against tax payable   :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '         b. ITC adjustment [14(VII)]         :'"
    '        mQry += "UNION ALL" & " SELECT '    iv. ITC carried forward                  :           0.00'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '                                      Total  :            NIL'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '15. Net Tax'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '    i.  Total tax payable (serial no.13)     :'+        (" & TotalSalesAndAddSalesTaxOnSale & ")"
    '        mQry += "UNION ALL" & " SELECT '    ii. ITC adjustment [14(iii)]             :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
    '        mQry += "UNION ALL" & " SELECT '    iii.Net Tax                              :'+        (" & NetTax & ")"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT '16. Details of Tax Deposited'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT 'A. Tax deposit in Bank / Treasury'"
    '        mQry += "UNION ALL" & " SELECT 'Name of the Bank / Branch           T.C.Number       Date          Amount'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT 'B. By Adjustment against adjustment vouchers'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT 'Adjustment Voucher No.                               Date          Amount'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT 'C. Total tax deposited (A+B)                           Total         0.00'"
    '        mQry += "UNION ALL" & " SELECT 'Rs. Zero Only'"
    '        mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
    '        mQry += "UNION ALL" & " SELECT 'Annexure 1 - Annexure A / A-1 / A-2 / B / B-1 whichever is applicable'"
    '        mQry += "UNION ALL" & " SELECT '         2 - Treasury Challan number.............../ date ..........'"
    '        mQry += "UNION ALL" & " SELECT '                       DECLARATION'"
    '        mQry += "UNION ALL" & " SELECT 'I ....................... S/o, D/o,W/o ..................... Status...........'"
    '        mQry += "UNION ALL" & " SELECT '[i.e.proprietor, director,partner etc.as provided in rule-32(6)], do hereby'"
    '        mQry += "UNION ALL" & " SELECT 'declare and verify that, to the best of my knowledge and belief all the'"
    '        mQry += "UNION ALL" & " SELECT 'statements and figures given in this return are ture and complete and nothing'"
    '        mQry += "UNION ALL" & " SELECT 'has been willfully omitted or wrongly stated.'"
    '        mQry += "UNION ALL" & " SELECT ''"
    '        mQry += "UNION ALL" & " SELECT 'Date  -                                  Signature -'"
    '        mQry += "UNION ALL" & " SELECT 'Place -                                  Status    -'"





    '        DsRep = AgL.FillData(mQry, AgL.GCn)



    '        If DsTemp IsNot Nothing Then
    '            'OExcelHandler.ExportToExcel("C:\Documents and Settings\Akash\Desktop\VatReturn", DsRep, "Write In Excel", ErrorMessage)
    '            OExcelHandler.ExportToExcel(My.Application.Info.DirectoryPath + "\" + "TaxReturn.xlsx", DsRep, "Write In Excel", ErrorMessage)
    '            System.Diagnostics.Process.Start(My.Application.Info.DirectoryPath + "\" + "TaxReturn.xlsx")


    '        End If
    '    Catch ex As Exception
    '        MsgBox(ex.Message)
    '    End Try
    'End Sub

    Private Sub FWriteTaxReturn(ByVal DsTemp As DataSet)
        Dim I As Integer = 0

        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing
        Dim DtAddSalesTaxForPurchase As DataTable = Nothing
        Dim DtSalesTaxForSale As DataTable = Nothing
        Dim DtAddSalesTaxForSale As DataTable = Nothing

        Dim PurchaseInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NOT NULL "
        Dim PurchaseInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NULL "
        Dim PurchaseOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
        Dim PurchaseOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

        Dim TotalPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
        Dim TotalPurchaseReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

        Dim NetAmtOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        Dim GrandTotalOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

        Dim TurnOverOfPurchaseOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TurnOverOfPurchaseFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TurnOverOfPurchaseTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalSalesTaxVatOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TotalSalesTaxVatFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TotalSalesTaxVatTwelvePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalAddSalesTaxPointFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
        Dim TotalAddSalesTaxOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

        Dim TotalSalesAndAddSalesTaxOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim TotalTurnOverOfPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "



        Dim SaleInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "' And H.TINNo IS NOT NULL "
        Dim SaleInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'   And H.TINNo IS NULL"
        Dim SaleOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
        Dim SaleOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0  And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

        Dim TotalSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
        Dim TotalSaleReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

        Dim NetAmtOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        Dim GrandTotalOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

        Dim TurnOverOfSaleOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TurnOverOfSaleFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TurnOverOfSaleTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalSalesTaxVatOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TotalSalesTaxVatFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TotalSalesTaxVatTwelvePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalAddSalesTaxPointFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
        Dim TotalAddSalesTaxOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

        Dim TotalSalesAndAddSalesTaxOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim TotalTurnOverOfSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "

        Dim TotalTax$ = " SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category In ('" & ClsMain.Voucher_Category.Sale & "','" & ClsMain.Voucher_Category.Purchase & "')  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim NetTax$ = " Select " & _
                " Str((SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0) " & _
                " - (SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0),15,2)   "


        mQry = " SELECT H.Sales_Tax_Per, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per "
        DtAddSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Sales_Tax_Per, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per "
        DtSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per "
        DtAddSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        Try
            mQry = " SELECT '                                  UPVAT - XXIV'"
            mQry += "UNION ALL" & " SELECT '           Department of Commercial Taxes,Government of Utter Pradesh'"
            mQry += "UNION ALL" & " SELECT '                    [See Rule-45(2) of the UPVAT Rules,2008]'"
            mQry += "UNION ALL" & " SELECT '                    Return of Tax Period - monthly/quarterly'"
            mQry += "UNION ALL" & " SELECT '1. Assessment Year                    : " & AgL.PubStartDate & " - " & AgL.PubEndDate & "'"
            mQry += "UNION ALL" & " SELECT '2. Tax Period                         : " & ReportFrm.FGetText(0) & " - " & ReportFrm.FGetText(1) & "'"
            mQry += "UNION ALL" & " SELECT '3. Designation of Assessing Authority :'"
            mQry += "UNION ALL" & " SELECT '4. Name of Circle / Sector            :'"
            mQry += "UNION ALL" & " SELECT '5. Name & Address of Dealer           : " & AgL.PubCompName & "'"
            mQry += "UNION ALL" & " SELECT '                                      : " & AgL.PubCompAdd1 & "'"
            mQry += "UNION ALL" & " SELECT '                                      : " & AgL.PubCompAdd2 & "'"
            mQry += "UNION ALL" & " SELECT '6. Taxpayer`s Indentification Number  : " & AgL.PubCompTIN & "'"
            mQry += "UNION ALL" & " SELECT '7.   Details of Purchase [in Rs.]'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  a. Vat Goods'"
            mQry += "UNION ALL" & " SELECT '     i.  Purchase in own a/c against tax invoice   :' + (" & PurchaseInOwnAcAgainstTaxInvoice & ")"
            mQry += "UNION ALL" & " SELECT '         (Annexure-A Part I)                       :'"
            mQry += "UNION ALL" & " SELECT '     ii. Purchase in own A/c from person other than:' + (" & PurchaseInOwnAcFromNonRegisteredDealer & ")"
            mQry += "UNION ALL" & " SELECT '         registered dealer                         :'"
            mQry += "UNION ALL" & " SELECT '     iii.Purchase of exempted goods                :' + (" & PurchaseOfExcemptGoods & ")"
            mQry += "UNION ALL" & " SELECT '     iv. Purchase from Ex.U.P.                     :' + (" & PurchaseOfExUp & ")"
            mQry += "UNION ALL" & " SELECT '     v.  Purchase in Principal A/c                 :'"
            mQry += "UNION ALL" & " SELECT '         (a) U.P.Principal                         :           0.00'"
            mQry += "UNION ALL" & " SELECT '         (a-i)  Principle against tax invoice      :'"
            mQry += "UNION ALL" & " SELECT '                (Annexure-A Part II)               :'"
            mQry += "UNION ALL" & " SELECT '         (a-ii) Other Purchase                     :'"
            mQry += "UNION ALL" & " SELECT '         (b) Ex.U.P.Principal                      :           0.00'"
            mQry += "UNION ALL" & " SELECT '     vi. Any other Purchase                        :           0.00'"
            mQry += "UNION ALL" & " SELECT '                                           Total   :' + (" & TotalPurchase & ")"
            mQry += "UNION ALL" & " SELECT '     vii.Less - Purchase Return (annexure-A1)      :' + (" & TotalPurchaseReturn & ")"
            mQry += "UNION ALL" & " SELECT '     viii. Net amount of purchase                  :' + (" & NetAmtOfPurchase & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  b. Non Vat Goods'"
            mQry += "UNION ALL" & " SELECT '     i.  Purchase from registered dealers          :'"
            mQry += "UNION ALL" & " SELECT '     ii. Purchase from unregistered                :'"
            mQry += "UNION ALL" & " SELECT '     iii.Purchase of exempted goods                :'"
            mQry += "UNION ALL" & " SELECT '     iv. Purchase from Ex.U.P.                     :'"
            mQry += "UNION ALL" & " SELECT '     v.  Purchase in Principal A/c                 :'"
            mQry += "UNION ALL" & " SELECT '         (a) U.P.Principal                         :'"
            mQry += "UNION ALL" & " SELECT '         (a-i)  Principle against tax invoice      :'"
            mQry += "UNION ALL" & " SELECT '                (Annexure-A Part II)               :'"
            mQry += "UNION ALL" & " SELECT '         (a-ii) Other Purchase                     :'"
            mQry += "UNION ALL" & " SELECT '         (b) Ex.U.P.Principal                      :'"
            mQry += "UNION ALL" & " SELECT '     vi. Any other Purchase                        :'"
            mQry += "UNION ALL" & " SELECT '                                           Total   :'"
            mQry += "UNION ALL" & " SELECT '     vii.Less - Purchase Return (annexure-A1)      :'"
            mQry += "UNION ALL" & " SELECT '     viii. Net amount of purchase                  :'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                     Grand Total   :' + (" & GrandTotalOfPurchase & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  c. Capital Goods Purchased from with the state'"
            mQry += "UNION ALL" & " SELECT '     i.  Purchase against tax invoice Annexure A-2 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     ii. Purchase from unregistered                :'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                           Total   :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  d. Purchase through commission agent for which'"
            mQry += "UNION ALL" & " SELECT '     certificate in form VI has been received'"
            mQry += "UNION ALL" & " SELECT 'S.No.  Certificate No.       Date       Value of goods   Amout of Tax'"
            mQry += "UNION ALL" & " SELECT '1.'"
            mQry += "UNION ALL" & " SELECT '2.'"
            mQry += "UNION ALL" & " SELECT '3.'"
            mQry += "UNION ALL" & " SELECT '                             Total   :'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '8.   Computation of tax on purchase'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '     Sl.No.   Rate of Tax      Commodity      Turnover of Purchase      Tax'"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '              Vat Goods'"


            For I = 0 To DtSalesTaxForPurchase.Rows.Count - 1
                mQry += "UNION ALL" & " SELECT '     " & (I + 1).ToString & "         ' + Str(" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Per")) & ",5,2)  + ' %                       :' + Str(" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & ",15,2)  + ' :' +           Str(" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")).ToString & ",15,2)"
            Next

            mQry += "UNION ALL" & " SELECT '     Additional Tax'"

            For I = 0 To DtAddSalesTaxForPurchase.Rows.Count - 1
                mQry += "UNION ALL" & " SELECT '     " & (I + 1).ToString & "         ' + Str(" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax_Per")) & ",5,2)  + ' %                       :' + Space(15)  + ' :' +           Str(" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")).ToString & ",15,2)"
            Next

            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                Total        :' + (" & TotalTurnOverOfPurchase & ") + ' :' +           (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '              Non Vat Goods'"
            mQry += "UNION ALL" & " SELECT '     vi.          20 %                       :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     vii.         32.5 %                     :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     viii.        ____ %                     :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                Total        :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                          Grand Total        :' + (" & GrandTotalOfPurchase & ") + ' :' +        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '9.   Details of Sale'"
            mQry += "UNION ALL" & " SELECT '  a. Vat Goods'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '     i.   Turnover of sale in own a/c against tax  :' + (" & SaleInOwnAcAgainstTaxInvoice & ")"
            mQry += "UNION ALL" & " SELECT '          invoice (annexure-B Part-1)              :'"
            mQry += "UNION ALL" & " SELECT '     ii.  Turnover of sale in own a/c other than in:' + (" & SaleInOwnAcFromNonRegisteredDealer & ")"
            mQry += "UNION ALL" & " SELECT '          column-i                                 :'"
            mQry += "UNION ALL" & " SELECT '     iii. Turnover of sale of exempted goods       :' + (" & SaleOfExcemptGoods & ")"
            mQry += "UNION ALL" & " SELECT '     iv.  Sale in Principal`s A/c                  :'"
            mQry += "UNION ALL" & " SELECT '          (a)  U.P.Principal                       :           0.00'"
            mQry += "UNION ALL" & " SELECT '          (a-i) Sales ag.tax invoice Annx-B Part-II:'"
            mQry += "UNION ALL" & " SELECT '          (a-ii)Other Sales                        :'"
            mQry += "UNION ALL" & " SELECT '          (b)  Ex.U.P.Pricipal                     :' + (" & SaleOfExUp & ")"
            mQry += "UNION ALL" & " SELECT '     v.   Interstate sale against form `C`         :           0.00'"
            mQry += "UNION ALL" & " SELECT '     vi.  Interstate sale without form `C`         :           0.00'"
            mQry += "UNION ALL" & " SELECT '     vii. Sale in course of export out of India    :           0.00'"
            mQry += "UNION ALL" & " SELECT '     viii Sale in course of import                 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     ix.  Sale outside state                       :           0.00'"
            mQry += "UNION ALL" & " SELECT '     x.   Consignment Sale                         :           0.00'"
            mQry += "UNION ALL" & " SELECT '     xi.  Any other sale                           :           0.00'"
            mQry += "UNION ALL" & " SELECT '                                           Total   :' + (" & TotalSale & ")"
            mQry += "UNION ALL" & " SELECT '     xii. Less - sales return (annexure B-1)       :' + (" & TotalSaleReturn & ")"
            mQry += "UNION ALL" & " SELECT '     xiii.Net amount of sales                      :' + (" & NetAmtOfSale & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  b. Non Vat Goods'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '     i.   Taxable turnover of sale                 :'"
            mQry += "UNION ALL" & " SELECT '     ii.  Exempted turnover of sale                :'"
            mQry += "UNION ALL" & " SELECT '     iii. Tax paid turnover of goods               :'"
            mQry += "UNION ALL" & " SELECT '     iv.  Sale in Principal`s A/c                  :'"
            mQry += "UNION ALL" & " SELECT '          (a)  U.P.Principal                       :'"
            mQry += "UNION ALL" & " SELECT '          (a-i) Sales ag.tax invoice Annx-B Part-II:'"
            mQry += "UNION ALL" & " SELECT '          (a-ii)Other Sales                        :'"
            mQry += "UNION ALL" & " SELECT '          (b)  Ex.U.P.Pricipal                     :'"
            mQry += "UNION ALL" & " SELECT '     v.   Any other Sale                           :'"
            mQry += "UNION ALL" & " SELECT '                                           Total   :'"
            mQry += "UNION ALL" & " SELECT '     vi.  Less - sales return (annexure B-1)       :'"
            mQry += "UNION ALL" & " SELECT '     vii. Net amount of sales                      :'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                     Grand Total   :' + (" & GrandTotalOfSale & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '  c. Sales through commission agent for which in form V has'"
            mQry += "UNION ALL" & " SELECT '     been received'"
            mQry += "UNION ALL" & " SELECT 'S.No.  Certificate No.       Date       Value of goods   Amout of Tax'"
            mQry += "UNION ALL" & " SELECT '1.'"
            mQry += "UNION ALL" & " SELECT '2.'"
            mQry += "UNION ALL" & " SELECT '3.'"
            mQry += "UNION ALL" & " SELECT '                             Total   :'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '10.  Computation of tax on sale'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '     Sl.No.   Rate of Tax      Commodity             Sale Amount        Tax'"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '              Vat Goods'"


            For I = 0 To DtSalesTaxForSale.Rows.Count - 1
                mQry += "UNION ALL" & " SELECT '     " & (I + 1).ToString & "         ' + Str(" & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Per")) & ",5,2)  + ' %                       :' + Str(" & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Taxable_Amt")) & ",15,2)  + ' :' +           Str(" & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax")).ToString & ",15,2)"
            Next

            mQry += "UNION ALL" & " SELECT '     Additional Tax'"

            For I = 0 To DtAddSalesTaxForSale.Rows.Count - 1
                mQry += "UNION ALL" & " SELECT '     " & (I + 1).ToString & "         ' + Str(" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax_Per")) & ",5,2)  + ' %                       :' + Space(15)  + ' :' +           Str(" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax")).ToString & ",15,2)"
            Next

            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                Total        :' + (" & TotalTurnOverOfSale & ") + ' :' +           (" & TotalSalesAndAddSalesTaxOnSale & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '              Non Vat Goods'"
            mQry += "UNION ALL" & " SELECT '     i.           20 %                       :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     ii.          32.5 %                     :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '     iii.         ____ %                     :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                Total        :           0.00 :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                          Grand Total        :' + (" & GrandTotalOfSale & ") + ' :' +        (" & TotalSalesAndAddSalesTaxOnSale & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '11. Installment of compounding scheme,if any :           0.00'"
            mQry += "UNION ALL" & " SELECT '12. Amount of T.D.S.                         :           0.00'"
            mQry += "UNION ALL" & " SELECT '13. Tax Payable'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '    i.  Tax on Purchase                      :' + (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '    ii. Tax on Sale                          :' + (" & TotalSalesAndAddSalesTaxOnSale & ")"
            mQry += "UNION ALL" & " SELECT '    iii.Installment of compounding scheme    :           0.00'"
            mQry += "UNION ALL" & " SELECT '    iv. T.D.S.Amount                         :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                       Total :' + (" & TotalTax & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '14. Detail of ITC'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '    i.  ITC brought forward from previous    :           0.00'"
            mQry += "UNION ALL" & " SELECT '    ii. ITC earned during the tax period     :'"
            mQry += "UNION ALL" & " SELECT '     a. On purchase made in own account      :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '     b. On purc.made through purchasing      :'"
            mQry += "UNION ALL" & " SELECT '        commission agent against in form VI  :'"
            mQry += "UNION ALL" & " SELECT '     c. Installment of ITC on opening stock  :'"
            mQry += "UNION ALL" & " SELECT '        due in the tax period                :'"
            mQry += "UNION ALL" & " SELECT '     d. Installment of ITC on capital goods  :'"
            mQry += "UNION ALL" & " SELECT '        due in the tax period                :'"
            mQry += "UNION ALL" & " SELECT '     e. ITC reversed during the tax period   :'"
            mQry += "UNION ALL" & " SELECT '     f. Admissible ITC in the tax period     :'"
            mQry += "UNION ALL" & " SELECT '    iii. a. Adjustment against tax payable   :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '         b. ITC adjustment [14(VII)]         :'"
            mQry += "UNION ALL" & " SELECT '    iv. ITC carried forward                  :           0.00'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '                                      Total  :            NIL'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '15. Net Tax'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '    i.  Total tax payable (serial no.13)     :'+        (" & TotalSalesAndAddSalesTaxOnSale & ")"
            mQry += "UNION ALL" & " SELECT '    ii. ITC adjustment [14(iii)]             :'+        (" & TotalSalesAndAddSalesTaxOnPurchase & ")"
            mQry += "UNION ALL" & " SELECT '    iii.Net Tax                              :'+        (" & NetTax & ")"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT '16. Details of Tax Deposited'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT 'A. Tax deposit in Bank / Treasury'"
            mQry += "UNION ALL" & " SELECT 'Name of the Bank / Branch           T.C.Number       Date          Amount'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT 'B. By Adjustment against adjustment vouchers'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT 'Adjustment Voucher No.                               Date          Amount'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT 'C. Total tax deposited (A+B)                           Total         0.00'"
            mQry += "UNION ALL" & " SELECT 'Rs. Zero Only'"
            mQry += "UNION ALL" & " SELECT '______________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________'"
            mQry += "UNION ALL" & " SELECT 'Annexure 1 - Annexure A / A-1 / A-2 / B / B-1 whichever is applicable'"
            mQry += "UNION ALL" & " SELECT '         2 - Treasury Challan number.............../ date ..........'"
            mQry += "UNION ALL" & " SELECT '                       DECLARATION'"
            mQry += "UNION ALL" & " SELECT 'I ....................... S/o, D/o,W/o ..................... Status...........'"
            mQry += "UNION ALL" & " SELECT '[i.e.proprietor, director,partner etc.as provided in rule-32(6)], do hereby'"
            mQry += "UNION ALL" & " SELECT 'declare and verify that, to the best of my knowledge and belief all the'"
            mQry += "UNION ALL" & " SELECT 'statements and figures given in this return are ture and complete and nothing'"
            mQry += "UNION ALL" & " SELECT 'has been willfully omitted or wrongly stated.'"
            mQry += "UNION ALL" & " SELECT ''"
            mQry += "UNION ALL" & " SELECT 'Date  -                                  Signature -'"
            mQry += "UNION ALL" & " SELECT 'Place -                                  Status    -'"





            DsRep = AgL.FillData(mQry, AgL.GCn)



            If DsTemp IsNot Nothing Then
                'OExcelHandler.ExportToExcel("C:\Documents and Settings\Akash\Desktop\VatReturn", DsRep, "Write In Excel", ErrorMessage)
                OExcelHandler.ExportToExcel(My.Application.Info.DirectoryPath + "\" + "TaxReturn.xlsx", DsRep, "Write In Excel", ErrorMessage)
                System.Diagnostics.Process.Start(My.Application.Info.DirectoryPath + "\" + "TaxReturn.xlsx")


            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteMainForm(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim PurchaseInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NOT NULL "
        Dim PurchaseInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NULL "
        Dim PurchaseOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
        Dim TotalSalesAndAddSalesTaxOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And H.SalesTaxGroupParty = 'Local' "
        Dim SaleInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "' And H.TINNo IS NOT NULL And H.SalesTaxGroupParty = 'Local' "
        Dim TotalSalesAndAddSalesTaxOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim NetTax$ = " Select " & _
                " Str((SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0  And H.SalesTaxGroupParty = 'Local' ) " & _
                " - (SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And H.SalesTaxGroupParty = 'Local' ),15,2)   "


        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        Try
            mQry = " SELECT 'Dealer''s TIN                                                              ' AS DESCRIPTION, '" & AgL.PubCompTIN & "' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'Financial Year                                             ' AS DESCRIPTION, ( " & StrFinancialYear & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'Tax Period (1,2,3)                                         ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'Month (1,2....12)                                          ' AS DESCRIPTION, ( '" & StrMonth & "' ) AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'Quarter (1,2,3,4)                                          ' AS DESCRIPTION, ( '" & StrQuarter & "' ) AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '11.Installment of compounding scheme, if any               ' AS DESCRIPTION,  '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '12.Amount of TDS                                           ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '13.Tax Payable [in Rs.]                                    ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'i.Tax on purchase                                          ' AS DESCRIPTION,  (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'ii.Tax on sale                                             ' AS DESCRIPTION,  (" & TotalSalesAndAddSalesTaxOnSale & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'iii.Installment of compounding scheme, if any              ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'iv.T.D.S. Amount                                           ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '14.Detail of ITC                                           ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'i.ITC brought forward from previous tax period             ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'ii.ITC earned during tax period                            ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(a)On Purchase made on own account                         ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(b)On Purchase made through purchasing commision agent against Certificate in Form VI ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(c)Installment of ITC on Opening Stock due on tax period   ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(d)Installment of ITC on Capital Goods due on tax period   ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(e)ITC reversed during on tax period                       ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(f)Admissible ITC in tax period (a+b+c+d+e)                ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'iii.(a)Adjustment of ITC against tax payable               ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '(B)Adjustment of ITC against CST                           ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'iv.ITC carried forward to next tax period, if any          ' AS DESCRIPTION, '0.00' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT '15.Net Tax                                                 ' AS DESCRIPTION, '' AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'i.Total tax payable(Serial No. 13)                         ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnSale & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'ii.ITC adjustment[14(iii)](a+b)                            ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS ENTRIES"
            mQry += " UNION ALL" & " SELECT 'iii.Net Tax                                                ' AS DESCRIPTION, (" & NetTax & ") AS ENTRIES"

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportToExcelMainForm(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If

            'MergeAllWorkbooks()
            ' add new worksheets & name worksheets ----------------------------


        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteVatNonVat(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0

        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing
        Dim DtAddSalesTaxForPurchase As DataTable = Nothing
        Dim DtSalesTaxForSale As DataTable = Nothing
        Dim DtAddSalesTaxForSale As DataTable = Nothing

        Dim PurchaseInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NOT NULL "
        Dim PurchaseInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  And H.TINNo IS NULL "
        Dim PurchaseOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
        Dim PurchaseOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

        Dim TotalPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
        Dim TotalPurchaseReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

        Dim NetAmtOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        Dim GrandTotalOfPurchase$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

        Dim TurnOverOfPurchaseOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TurnOverOfPurchaseFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TurnOverOfPurchaseTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalSalesTaxVatOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TotalSalesTaxVatFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TotalSalesTaxVatTwelvePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalAddSalesTaxPointFivePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
        Dim TotalAddSalesTaxOnePerOnPurchase$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

        Dim TotalSalesAndAddSalesTaxOnPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim TotalTurnOverOfPurchase$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "



        Dim SaleInOwnAcAgainstTaxInvoice$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "' And H.TINNo IS NOT NULL "
        Dim SaleInOwnAcFromNonRegisteredDealer$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) > 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "') = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'   And H.TINNo IS NULL"
        Dim SaleOfExcemptGoods$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax,0) = 0 And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "
        Dim SaleOfExUp$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0  And IsNull(S.Nature,'" & ClsMain.SalesTaxGroupPartyNature.Local & "')  = '" & ClsMain.SalesTaxGroupPartyNature.Central & "' "

        Dim TotalSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "
        Dim TotalSaleReturn$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) < 0  "

        Dim NetAmtOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        Dim GrandTotalOfSale$ = " SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "

        Dim TurnOverOfSaleOnePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TurnOverOfSaleFivePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TurnOverOfSaleTwelvePer$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalSalesTaxVatOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 1 "
        Dim TotalSalesTaxVatFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 5 "
        Dim TotalSalesTaxVatTwelvePerOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) = 12.5 "

        Dim TotalAddSalesTaxPointFivePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 0.5 "
        Dim TotalAddSalesTaxOnePerOnSale$ = "SELECT Str(IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Additional_Sales_Tax_Per,0) = 1 "

        Dim TotalSalesAndAddSalesTaxOnSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim TotalTurnOverOfSale$ = "SELECT Str(IsNull(Sum(H.Sales_Tax_Taxable_Amt),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 And IsNull(H.Sales_Tax_Per,0) <> 0 "

        Dim TotalTax$ = " SELECT Str(IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0),15,2) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category In ('" & ClsMain.Voucher_Category.Sale & "','" & ClsMain.Voucher_Category.Purchase & "')  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0 "

        Dim NetTax$ = " Select " & _
                " Str((SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0) " & _
                " - (SELECT IsNull(Sum(H.Sales_Tax),0) + IsNull(Sum(H.Additional_Sales_Tax),0) FROM View_Vat H LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type LEFT JOIN SubGroup Sg ON H.SubCode = Sg.SubCode LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'  AND H.V_Date BETWEEN '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' And IsNull(H.Qty,0) > 0),15,2)   "


        mQry = " SELECT H.Sales_Tax_Per, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per "
        DtAddSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Sales_Tax_Per, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per "
        DtSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per "
        DtAddSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        Try
            mQry = " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '1' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase in Own A/C against tax invoice(annexure-A Part I)' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '2' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase in Own A/C from unregistered Dealer' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '3' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase of exempted goods' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase from Ex. U.P.' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase in principals A/C' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5a1' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase against tax invoice(annexure-A Part II)' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5a2' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Other Purchase' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5b' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Ex. U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5a' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5b' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Ex. U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '6' AS Code, 'v' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Any Other Purchase' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '1' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase from Registered Dealer' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '2' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase from Unregistered' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '3' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase of exempted goods' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase from Ex. U.P.' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase in principals A/c' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '1' AS Code, 'cg' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase against tax invoice(annexure-A2)' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '2' AS Code, 'cg' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase from person other than registered Dealer' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '6' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Any Other Purchase' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '7a' AS Code, 'os' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Purchase against Form C / Form H / Form I' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '7b' AS Code, 'os' AS [VAT/NONVAT/Other-State],'p' AS [Sale/Purchase],'Value of goods received from outside State against Form F' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '1' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Turnover of sale in own A/C against tax invoice(annexure-B)' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '2' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Turnover of sale other than in column-1' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '3' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Turnover of sale of exempted goods' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Interstate sale against Form C' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '5' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Interstate sale without Form C' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '6' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Sale in course of export out of India' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '7' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Sale in course of import' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '8' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Sale outside state ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '9' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Consignment sale /Stock Transfer' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '10' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Any other sale' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '1' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Taxable Turnover of sale' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '2' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Exempted Turnover of sale' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '3' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Tax paid turnover of goods ' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Sale in Principal A/C' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4a1' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Sale against tax invoice(annexure-B Part-II)' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4a2' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Other sale' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4b' AS Code, 'v' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Ex. U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4a' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4b' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Ex. U.P. Principal' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "
            mQry += "UNION ALL" & " SELECT '" & AgL.PubCompTIN & "' AS [Tin No], (" & StrFinancialYear & ") AS [Financial Year], '' AS [Tax Period], ('" & StrMonth & "') AS [Month], ('" & StrQuarter & "') AS Quarter, '4' AS Code, 'nv' AS [VAT/NONVAT/Other-State],'s' AS [Sale/Purchase],'Any other sale amount' AS DESCRIPTION, (" & TotalSalesAndAddSalesTaxOnPurchase & ") AS [Amount (in Rs.)]  "

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportToExcelVatNonVat(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteTaxDetailSale(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtAddSalesTaxForSale As DataTable = Nothing
        Dim DtSalesTaxForSale As DataTable = Nothing

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        mQry = " SELECT H.Sales_Tax_Per , ISNULL(VC.ManualCode,'') AS VatCommodityCode, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per , VC.ManualCode "
        DtSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, ISNULL(VC.ManualCode,'') AS VatCommodityCode, " & _
                " Sum(H.Sales_Tax_Taxable_Amt) AS Additional_Tax_Taxable_Amt, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Sale & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per, VC.ManualCode "
        DtAddSalesTaxForSale = AgL.FillData(mQry, AgL.GCn).Tables(0)

        Try
            mQry = ""
            For I = 0 To DtSalesTaxForSale.Rows.Count - 1
                If mQry = "" Then
                    mQry = "SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'V' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtSalesTaxForSale.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code],  Str(" & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Sale Amount], " & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax")).ToString & " AS [Sale Tax Amount] "
                Else
                    mQry += " Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'V' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtSalesTaxForSale.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code],  Str(" & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Sale Amount], " & AgL.XNull(DtSalesTaxForSale.Rows(I)("Sales_Tax")).ToString & " AS [Sale Tax Amount] "
                End If
            Next

            For I = 0 To DtAddSalesTaxForSale.Rows.Count - 1
                If mQry = "" Then
                    mQry = "SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'AT' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code], Str(" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Tax_Taxable_Amt")) & " AS [Sale Amount], " & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax")).ToString & " AS [Sale Tax Amount] "
                Else
                    mQry += " Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'AT' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code], Str(" & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Tax_Taxable_Amt")) & " AS [Sale Amount], " & AgL.XNull(DtAddSalesTaxForSale.Rows(I)("Additional_Sales_Tax")).ToString & " AS [Sale Tax Amount] "
                End If
            Next

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportTaxSaleDetail(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteTaxDetailPurchase(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing
        Dim DtAddSalesTaxForPurchase As DataTable = Nothing

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        mQry = " SELECT H.Sales_Tax_Per , ISNULL(VC.ManualCode,'') AS VatCommodityCode, Sum(H.Sales_Tax_Taxable_Amt) AS Sales_Tax_Taxable_Amt, " & _
                " Sum(H.Sales_Tax) AS Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Sales_Tax_Per,0) <> 0 " & _
                " GROUP BY H.Sales_Tax_Per , VC.ManualCode "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)

        mQry = " SELECT H.Additional_Sales_Tax_Per, ISNULL(VC.ManualCode,'') AS VatCommodityCode, " & _
                " Sum(H.Sales_Tax_Taxable_Amt) AS Additional_Tax_Taxable_Amt, Sum(H.Additional_Sales_Tax) AS Additional_Sales_Tax " & _
                " FROM View_Vat H  " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode " & _
                " WHERE Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "' " & _
                " AND IsNull(H.Additional_Sales_Tax,0) <> 0 " & _
                " GROUP BY H.Additional_Sales_Tax_Per, VC.ManualCode "
        DtAddSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)


        Try
            mQry = ""
            For I = 0 To DtSalesTaxForPurchase.Rows.Count - 1
                If mQry = "" Then
                    mQry = "SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'V' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code],  Str(" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Purchase Amount], " & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")).ToString & " AS [Purchase Tax Amount] "
                Else
                    mQry += " Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'V' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code],  Str(" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Purchase Amount], " & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")).ToString & " AS [Purchase Tax Amount] "
                End If
            Next

            For I = 0 To DtAddSalesTaxForPurchase.Rows.Count - 1
                If mQry = "" Then
                    mQry = "SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'AT' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code], Str(" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Tax_Taxable_Amt")) & " AS [Purchase Amount], " & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")).ToString & " AS [Purchase Tax Amount] "
                Else
                    mQry += " Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], 'AT' AS [Vat/Non Vat/Additional Tax(V/NV/AT)], '" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("VatCommodityCode")).ToString & "' AS [Commodity Code], Str(" & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax_Per")).ToString & ",15,2) AS [Tax Rate], " & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Tax_Taxable_Amt")) & " AS [Purchase Amount], " & AgL.XNull(DtAddSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")).ToString & " AS [Purchase Tax Amount] "
                End If
            Next

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportTaxSaleDetail(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteVatBankDetail(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Assessment Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Bank Code], '' AS [Bank Branch Name], '' AS District, '' AS [Challan No],'' AS [Date],'' AS Amount, " & _
                    " '' AS [Type (A for Voucher and B for Bank)] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportVatBankDetail(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_A(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim mCondStr As String = ""
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'"
        mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
        mCondStr = mCondStr & " AND H.TinNo Is Not Null "
        mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "

        mQry = " SELECT H.RecId AS InvoiceNo,  convert(NVARCHAR,H.V_Date,103) AS V_Date, VC.ManualCode AS CommodityCode,  Str(H.Qty, 12, 2) AS Qty, " & _
                " H.Sales_Tax_Taxable_Amt, H.Sales_Tax, H.Additional_Sales_Tax, H.Net_Amount, H.TINNo, H.Unit " & _
                " FROM View_Vat H " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item  " & _
                " LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode  " & _
                " " & mCondStr & " "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)


        Try
            mQry = ""
            For I = 0 To DtSalesTaxForPurchase.Rows.Count - 1
                If mQry = "" Then
                    mQry = " SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Code], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Goods], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [VAT Charged]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")) & " AS [SAT Charged], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [VendorCustomerTIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit]," & _
                            " '1' AS [Type (1-Own A/c & 2-Commission A/C)]"
                Else
                    mQry += "  Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Code], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Goods], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [VAT Charged]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")) & " AS [SAT Charged], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [VendorCustomerTIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit]," & _
                            " '1' AS [Type (1-Own A/c & 2-Commission A/C)]"
                End If
                DsRep = AgL.FillData(mQry, AgL.GCn)
            Next




            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportAnnuxer24(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If

        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_A1(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Invoice No], '' AS [Invoice Date], '' AS [Commodity Code], '' AS [Commodity Qty],'' AS [Taxable Goods],'' AS [VAT Charged], " & _
                    " '' AS [SAT Charged],'' AS [Total Invoice Value], '' AS [Vendor Customer TIN], '' AS Unit, '' AS [Credit Note No.], '' AS [Credit Note Date], " & _
                    " '' AS [Debit Note No.], ''  AS [Debit Note Date],'' AS [Vat/Non-Vat(V/NV)] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_A1(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_A2(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Invoice No], '' AS [Invoice Date], '' AS [Commodity Code], '' AS [Commodity Qty],'' AS [Taxable Goods],'' AS [VAT Charged], " & _
                    " '' AS [SAT Charged],'' AS [Total Invoice Value], '' AS [Vendor Customer TIN], '' AS Unit, '' AS [Type(1-Reg Dealer & 2-UnReg Dealer)]"
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_A2(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_B(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim mCondStr As String = ""
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Sale & "'"
        mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
        mCondStr = mCondStr & " AND H.TinNo Is Not Null "
        mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Local & "'  "

        mQry = " SELECT H.RecId AS InvoiceNo,  convert(NVARCHAR,H.V_Date,103) AS V_Date, VC.ManualCode AS CommodityCode,  Str(H.Qty, 12, 2) AS Qty, " & _
                " H.Sales_Tax_Taxable_Amt, H.Sales_Tax, H.Additional_Sales_Tax, H.Net_Amount, H.TINNo, H.Unit " & _
                " FROM View_Vat H " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN Item I ON I.Code = H.Item  " & _
                " LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode  " & _
                " " & mCondStr & " "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)


        Try
            mQry = ""
            For I = 0 To DtSalesTaxForPurchase.Rows.Count - 1
                If mQry = "" Then
                    mQry = " SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Code], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Goods], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [VAT Charged]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")) & " AS [SAT Charged], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [VendorCustomerTIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit]," & _
                            " '1' AS [Type (1-Own A/c & 2-Commission A/C)]"
                Else
                    mQry += "  Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Code], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Goods], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [VAT Charged]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")) & " AS [SAT Charged], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [VendorCustomerTIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit]," & _
                            " '1' AS [Type (1-Own A/c & 2-Commission A/C)]"
                End If
                DsRep = AgL.FillData(mQry, AgL.GCn)
            Next




            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportAnnuxer24(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If

        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_B1(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Invoice No], '' AS [Invoice Date], '' AS [Commodity Code], '' AS [Commodity Qty],'' AS [Taxable Goods],'' AS [VAT Charged], " & _
                    " '' AS [SAT Charged],'' AS [Total Invoice Value], '' AS [Vendor Customer TIN], '' AS Unit, '' AS [Credit Note No.], '' AS [Credit Note Date], " & _
                    " '' AS [Debit Note No.], ''  AS [Debit Note Date],'' AS [Vat/Non-Vat(V/NV)] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_A1(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteCommAgent(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                         ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Assessment Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Certificate No.], '' AS [Date], '' AS [Value of Goods], '' AS [Amount],'' AS [Type(S-Sold/P-Purchase)]"
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportCommAgent(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_C(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                     ByVal xlWB As Excel.Workbook)
        Dim I As Integer = 0
        Dim mCondStr As String = ""
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Dim DtSalesTaxForPurchase As DataTable = Nothing

        Dim StrFinancialYear$ = " SELECT cyear FROM Company WHERE Comp_Code =  '" & AgL.PubCompCode & "' "
        Dim StrMonth$ = CDate(ReportFrm.FGetText(0)).Month.ToString
        Dim StrQuarter$ = ""
        If CDate(ReportFrm.FGetText(0)).Month >= 4 And CDate(ReportFrm.FGetText(0)).Month <= 6 Then
            StrQuarter = "1"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 7 And CDate(ReportFrm.FGetText(0)).Month <= 9 Then
            StrQuarter = "2"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 10 And CDate(ReportFrm.FGetText(0)).Month <= 12 Then
            StrQuarter = "3"
        ElseIf CDate(ReportFrm.FGetText(0)).Month >= 1 And CDate(ReportFrm.FGetText(0)).Month <= 3 Then
            StrQuarter = "4"
        End If

        mCondStr = " Where Vt.Category = '" & ClsMain.Voucher_Category.Purchase & "'"
        mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
        mCondStr = mCondStr & " AND IsNull(H.Qty,0) > 0  "
        'mCondStr = mCondStr & " AND H.TinNo Is Not Null "
        'mCondStr = mCondStr & " And S.Nature = '" & ClsMain.SalesTaxGroupPartyNature.Central & "'  "

        mQry = " SELECT H.RecId AS InvoiceNo,  convert(NVARCHAR,H.V_Date,103) AS V_Date, VC.ManualCode AS CommodityCode,  Str(H.Qty, 12, 2) AS Qty, " & _
                " H.Sales_Tax_Taxable_Amt, H.Sales_Tax, H.Additional_Sales_Tax, H.Net_Amount, H.TINNo, H.Unit,SG.DispName AS SellerName, iSNULL(SG.Add1,'') + ' ' + isnull(SG.Add2,'') + '-' + Isnull(C.CityName,'') AS  SellerAddress, " & _
                " C.State AS SellerState, H.Form, H.FormNo " & _
                " FROM View_Vat H " & _
                " LEFT JOIN Voucher_Type Vt ON H.V_Type = Vt.V_Type " & _
                " LEFT JOIN SUBGROUP SG ON H.SubCode = SG.SubCode " & _
                " LEFT JOIN City C ON C.CityCode = SG.CityCode " & _
                " LEFT JOIN Item I ON I.Code = H.Item  " & _
                " LEFT JOIN PostingGroupSalesTaxParty S On H.SalesTaxGroupParty = S.Description " & _
                " LEFT JOIN VatCommodityCode VC ON VC.Code = I.VatCommodityCode  " & _
                " " & mCondStr & " "
        DtSalesTaxForPurchase = AgL.FillData(mQry, AgL.GCn).Tables(0)


        Try
            mQry = ""
            For I = 0 To DtSalesTaxForPurchase.Rows.Count - 1
                If mQry = "" Then
                    mQry = " SELECT '" & AgL.PubCompTIN & "' AS [Dealer'Tin],  ( " & StrFinancialYear & " ) AS [Assessment Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [Seller TIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerName")) & "' AS [Seller Name], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerAddress")) & "' AS [Seller Address], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerState")) & "' AS [Seller State], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("FormNo")) & "' AS [Form-38 Number], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerState")) & "' AS [Seller State], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '' AS [Purchase Order Number],'' AS [Purchase Order Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Name], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Amount], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [Tax]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '1' AS [Purpose(1/2/3/4/5/6/7/8)]"
                Else
                    'mQry += "  Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer Tin],  ( " & StrFinancialYear & " ) AS [Financial Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                    '        " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                    '        " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Code], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                    '        " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Goods], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [VAT Charged]," & _
                    '        " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Additional_Sales_Tax")) & " AS [SAT Charged], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                    '        " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [VendorCustomerTIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit]," & _
                    '        " '1' AS [Type (1-Own A/c & 2-Commission A/C)]"

                    mQry += "  Union All SELECT '" & AgL.PubCompTIN & "' AS [Dealer'Tin],  ( " & StrFinancialYear & " ) AS [Assessment Year], '' AS  [Tax Period], '" & StrMonth & "' AS Month, '" & StrQuarter & "' AS [Quarter], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("TINNo")) & "' AS [Seller TIN], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerName")) & "' AS [Seller Name], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerAddress")) & "' AS [Seller Address], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerState")) & "' AS [Seller State], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("FormNo")) & "' AS [Form-38 Number], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("SellerState")) & "' AS [Seller State], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("InvoiceNo")).ToString & "' AS [Invoice No],  '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("V_Date")).ToString & "' AS [Invoice Date], " & _
                            " '' AS [Purchase Order Number],'' AS [Purchase Order Date], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("CommodityCode")).ToString & "' AS [Commodity Name], '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Qty")) & "' AS [Commodity Qty], " & _
                            " '" & AgL.XNull(DtSalesTaxForPurchase.Rows(I)("Unit")) & "' AS [Unit], " & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax_Taxable_Amt")) & " AS [Taxable Amount], " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Sales_Tax")) & " AS [Tax]," & _
                            " " & AgL.VNull(DtSalesTaxForPurchase.Rows(I)("Net_Amount")) & " AS [Total Invoice Value]," & _
                            " '1' AS [Purpose(1/2/3/4/5/6/7/8)]"

                    ' " '1' AS [Purpose(1/2/3/4/5/6/7/8) 1.Resale 2.Manufacturing/Processing 3.Mining 4.Generation of Power 5.Packing of Goods 6.Stock Transfer 7.Any Other Purchase 8.Other than Purchase (Job Work, Sale Consumption etc.)]"
                End If
            Next

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_C(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If

        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_D(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                     ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
            " '' AS [Seller Tin], '' AS [Seller Name], '' AS [Seller Address], '' AS [Seller State], '' AS [Invoice No],'' AS [Invoice Date], " & _
            " '' AS [Commodity Name], '' AS [Commodity Qty], '' AS Unit, '' AS [Value of Goods], '' AS [Goods Dispatched Via], '' AS [Postal Reciept No], '' AS [Postal Reciept Date], " & _
            " '' AS [Date of Goods Received] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_D(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_E(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                     ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
            " '' AS [Name of Seller],'' AS [Seller Tin], '' AS [Seller Address], '' AS [Seller State], '' AS [Purchase Order No],'' AS [Purchase Order Date], " & _
            " '' AS [Invoice No], '' AS [Invoice Date], " & _
            " '' AS [Commodity Name], '' AS [Commodity Qty], '' AS Unit, '' AS [Value], '' AS [Export Order No],'' AS [Export Order Date], '' AS [Export Station], " & _
            " '' AS [Name_Means of Export], '' AS [Proof Export No], '' AS [Proof Export Date], '' AS [Export Commodity Name], '' AS [Export Commodity Qty], '' AS [Export Commodity Unit], " & _
            " '' AS [Total Value of Goods] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_E(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

    Private Sub FWriteForm24_Annexure_F(ByVal DsTemp As DataSet, ByVal xlObject As Excel.Application, _
                                     ByVal xlWB As Excel.Workbook)
        Dim ErrorMessage As String = String.Empty
        Dim OExcelHandler As New ExcelHandler()
        Try
            mQry = " SELECT '' AS [Dealer's TIN], '' AS [Financial Year], '' AS [Tax Period],'' AS Month, '' AS Quarter, " & _
                    " '' AS [Name of Seller],'' AS [Seller Tin], '' AS [Address], '' AS [Seller State], '' AS [Purchase Order No],'' AS [Purchase Order Date], " & _
                    " '' AS [Invoice No], '' AS [Invoice Date], " & _
                    " '' AS [Commodity Name], '' AS [Goods Value] "
            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsTemp IsNot Nothing Then
                OExcelHandler.ExportForm24_Annexure_F(DsRep, "Write In Excel", ErrorMessage, xlObject, xlWB)
            End If
        Catch ex As Exception
            MsgBox(ex.Message)
        End Try
    End Sub

#Region "Bill Wise Profitabilty"
    Private Sub ProcBillWiseProfitabilty()
        Try
            RepName = "Trade_BillWiseProfitabilty" : RepTitle = "Bill Wise Profitabilty"


            Dim mCondStr$ = ""
            Dim strGrpFld As String = "''", strGrpFldHead As String = "''", strGrpFldDesc As String = "''"

            mCondStr = " Where 1 = 1 "
            mCondStr = mCondStr & " AND H.V_Date Between '" & ReportFrm.FGetText(0) & "' And '" & ReportFrm.FGetText(1) & "' "
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.SaleToParty", 2)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("L.Item", 3)
            mCondStr = mCondStr & ReportFrm.GetWhereCondition("H.DocID", 4)

            If ReportFrm.GetWhereCondition("ItemRrportingGroup", 5) <> "" Then
                mQry = " Select '''' +  replace(ItemList,',',''',''')  + ''''  From ItemReportingGroup Where 1=1 " & ReportFrm.GetWhereCondition("Code", 5)
                mCondStr = mCondStr & " And L.Item In (" & AgL.Dman_Execute(mQry, AgL.GCn).ExecuteScalar & ")"
            End If

            mQry = " SELECT H.DocID , H.V_Type, H.V_Date, H.ReferenceNo, Sg.Name As SaleToPartyName, H.SaleToParty , " & _
                    " L.Sr, L.Item , L.Qty, L.Unit, L.Rate, L.Amount, L.Landed_Value AS SaleValue, " & _
                    " I.Description AS ItemDesc , PCD.Landed_Value/PCD.Qty * L.Qty AS PurchaseValue ,  " & _
                    " L.Landed_Value - PCD.Landed_Value/PCD.Qty * L.Qty AS Profit,  " & _
                    " CASE WHEN isnull(PCD.Landed_Value/PCD.Qty * L.Qty,0) > 0 THEN ( L.Landed_Value - PCD.Landed_Value/PCD.Qty * L.Qty) * 100 / ( PCD.Landed_Value/PCD.Qty * L.Qty) ELSE 0 END AS ProfitPer " & _
                    " FROM SaleInvoice  H " & _
                    " LEFT JOIN SubGroup Sg On H.SaleToParty = Sg.SubCode " & _
                    " LEFT JOIN SaleInvoiceDetail L ON L.DocId = H.DocID  " & _
                    " LEFT JOIN Item I ON I.Code = L.Item  " & _
                    " LEFT JOIN PurchChallanDetail PCD ON PCD.DocId = L.ReferenceDocId AND PCD.Sr  = L.ReferenceDocIdSr " & mCondStr
            DsRep = AgL.FillData(mQry, AgL.GCn)



            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region


#Region "Party Outstanding Report"
    Private Sub ProcPartyOutstandingReport()
        Dim mCondStr1$ = ""
        Dim mCondStr2$ = ""
        Try
            RepName = "BillWiseOutstandingReport" : RepTitle = "Party Outstanding Report"

            mCondStr1 = " Where LG.V_Date <= '" & ReportFrm.FGetText(0) & "' "
            mCondStr2 = " Where LG.V_Date <= '" & ReportFrm.FGetText(0) & "' "

            mCondStr1 = mCondStr1 & ReportFrm.GetWhereCondition("LG.SubCode", 1)
            mCondStr2 = mCondStr2 & ReportFrm.GetWhereCondition("LG.SubCode", 1)

            mCondStr1 = mCondStr1 & " And  LG.Site_Code IN (" & AgL.PubSiteCode & ") "
            mCondStr2 = mCondStr2 & " And  LG.Site_Code IN (" & AgL.PubSiteCode & ") "

            mCondStr1 = mCondStr1 & " And  Sg.Nature In ('" & ClsMain.SubGroupNature.Customer & "','" & ClsMain.SubGroupNature.Supplier & "') "
            mCondStr2 = mCondStr2 & " And  Sg.Nature In ('" & ClsMain.SubGroupNature.Customer & "','" & ClsMain.SubGroupNature.Supplier & "') "

            mCondStr1 = mCondStr1 & " And  IsNull(Lg.AmtDr,0) > 0 "

            mQry = "Select DocId, V_SNo, Max(RecId) As RecId, Max(V_Type) As V_Type, " & _
                            " Max(V_Date) As V_Date, Max(Narration) As Narration, " & _
                            " Max(Sg.Name) As PartyName, Max(C.CityName) As CityName, " & _
                            " Max(BillAmt) As BillAmt, Abs(Sum(Adjusted)) As Receipt, " & _
                            " Max(BillAmt) - Abs(Sum(Adjusted)) As Balance," & _
                            " Max(DateAdd(Day,IsNull(Sg.CreditDays,0),Tmp.V_Date)) As DueDate, " & _
                            " Max(Datediff(Day, Dateadd(Day,Sg.CreditDays,Tmp.V_Date),getdate())) AS OverDue  " & _
                            " From ( " & _
                            "       Select  LG.DocId,LG.V_SNo, LG.RecId As RecId, " & _
                            "       LG.V_Type, LG.V_Date, LG.Narration, Lg.SubCode, " & _
                            "       IsNull(Lg.AmtDr,0) As BillAmt,0 As Adjusted " & _
                            "       From Ledger LG " & _
                            "       LEFT JOIN SubGroup Sg On Lg.SubCode = Sg.SubCode " & mCondStr1 & _
                            "       And IsNull(Lg.AmtDr,0) > 0 " & _
                            " Union All " & _
                            "       Select	LA.Adj_DocId As DocId,LA.Adj_V_SNo As V_SNo,Null As RecId,Null As V_Type,Null As V_Date, " & _
                            "       Null As Narration, Lg.SubCode,0 As BillAmt,LA.Amount As Adjusted	 " & _
                            "       From LedgerAdj LA " & _
                            "       Left Join Ledger LG On LA.Adj_DocId = LG.DocId And LA.Adj_V_SNo = LG.V_SNo " & _
                            "       Left Join SubGroup Sg On Lg.SubCode = Sg.SubCode " & mCondStr2 & _
                            " ) As Tmp " & _
                            " LEFT JOIN SubGroup Sg On Tmp.SubCode = Sg.SubCode " & _
                            " LEFT JOIN City C On SG.CityCode = C.CityCode " & _
                            " Group By DocId, V_SNo " & _
                            " Having (IsNull(Max(BillAmt),0)-IsNull(Sum(Adjusted),0))>0" & _
                            " Order By Max(V_Date),Max(RecId) "


            'mQry = "Select LG.DocId,LG.V_SNo,Convert(Varchar,Max(LG.V_No)) as VNo,Max(LG.V_Type) as VType,Max(LG.V_Date) as VDate,Max(SG.Name) As PName,"
            'mQry = mQry + "Max(LG.SubCode) as SubCode,Max(LG.Narration) as Narration,Max(LG.AmtDr) as Amt1,0 As Amt2,IsNull(Sum(LA.Amount),0) as Amt, "
            'mQry = mQry + "Max(SG.Add1)As Add1,Max(SG.Add2)As Add2,Max(C.CityName)As CityName,Max(CT.Name) as Country,MAx(St.name) As SiteName,max(Ag.GroupName) as AcGroupName, Max(Lg.RecId) As RecId, "
            'mQry = mQry + "Max(DateAdd(Day,IsNull(Sg.CreditDays,0),Lg.V_Date)) As DueDate, "
            'mQry = mQry + "Max(Datediff(Day, Dateadd(Day,Sg.CreditDays,Lg.V_Date),getdate())) AS OverDue "
            'mQry = mQry + "From Ledger LG Left Join SubGroup SG On LG.Subcode=SG.SubCode Left Join "
            'mQry = mQry + "City C on SG.CityCode=C.CityCode Left Join Country CT on SG.CountryCode=CT.Code LEFT JOIN AcGroup AG ON SG.GroupCode =AG.GroupCode  "
            'mQry = mQry + "Left Join LedgerAdj LA On LG.DocId=LA.Adj_DocID  And LG.V_SNo=LA.Adj_V_SNo "
            'mQry = mQry + "LEFT JOIN SiteMast ST ON LG.Site_Code =St.code  "
            'mQry = mQry + "LEFT JOIN ZoneMast ZM ON ZM.Code =SG.Zone "
            'mQry = mQry + mCondStr1
            'mQry = mQry + "Group By LG.DocId,LG.V_SNo "
            'mQry = mQry + "HAVING(IsNull(Sum(LA.Amount), 0) <> Max(LG.AmtDr))"
            'mQry = mQry + "Union All "
            'mQry = mQry + "Select	LG.DocId,LG.V_SNo,Convert(Varchar,LG.V_No) As V_No,LG.V_Type,LG.V_Date,SG.Name As PName,LG.SubCode, "
            'mQry = mQry + "LG.Narration,0 As Amt1,ISNULL(LG.AmtCr,0)-ISNULL(T.AMOUNT,0) as Amt2,0 As Amount,Null As Add1,Null As Add2,"
            'mQry = mQry + "Null As CityName,Null As Country,ST.name As sitename,isnull(Ag.GroupName,'') as AcGroupName, Lg.RecId As RecId,  "
            'mQry = mQry + "DateAdd(Day,IsNull(Sg.CreditDays,0),Lg.V_Date) As DueDate, "
            'mQry = mQry + "Datediff(Day, Dateadd(Day,Sg.CreditDays,Lg.V_Date),getdate()) AS OverDue "
            'mQry = mQry + "From Ledger LG Left Join SubGroup SG On SG.SubCode=LG.SubCode LEFT JOIN AcGroup AG ON SG.GroupCode =AG.GroupCode LEFT JOIN ZoneMast ZM ON ZM.Code =SG.Zone  LEFT JOIN SiteMast ST ON LG.Site_Code =St.code   "
            'mQry = mQry + "LEFT JOIN (SELECT LA.Vr_Docid AS Docid,LA.Vr_V_SNo AS S_No,SUM(AMOUNT) AS AMOUNT FROM LedgerAdj LA GROUP BY LA.Vr_DocId,LA.Vr_V_SNo) T ON T.DOCID=LG.DOCID AND T.S_NO=LG.V_SNO  "
            'mQry = mQry + mCondStr2

            DsRep = AgL.FillData(mQry, AgL.GCn)

            If DsRep.Tables(0).Rows.Count = 0 Then Err.Raise(1, , "No Records to Print!")

            ReportFrm.PrintReport(DsRep, RepName, RepTitle)
        Catch ex As Exception
            MsgBox(ex.Message)
            DsRep = Nothing
        End Try
    End Sub
#End Region

    

    '    Sub MergeAllWorkbooks()
    '        Dim MyPath As String, FilesInPath As String
    '        Dim MyFiles() As String = Nothing
    '        Dim SourceRcount As Long, FNum As Long
    '        Dim mybook As Workbook = Nothing
    '        Dim BaseWks As Worksheet = Nothing
    '        Dim sourceRange As Range, destrange As Range
    '        Dim rnum As Long, CalcMode As Long
    '        Dim Application As New Excel.Application
    '        Dim xlWBATWorksheet As Object = System.Reflection.Missing.Value


    '        ' Change this to the path\folder location of your files.
    '        MyPath = My.Application.Info.DirectoryPath

    '        ' Add a slash at the end of the path if needed.
    '        If Right(MyPath, 1) <> "\" Then
    '            MyPath = MyPath & "\"
    '        End If

    '        ' If there are no Excel files in the folder, exit.
    '        FilesInPath = Dir(MyPath & "*.xl*")
    '        If FilesInPath = "" Then
    '            MsgBox("No files found")
    '            Exit Sub
    '        End If

    '        ' Fill the myFiles array with the list of Excel files
    '        ' in the search folder.
    '        FNum = 0
    '        Do While FilesInPath <> ""
    '            FNum = FNum + 1
    '            ReDim Preserve MyFiles(FNum)
    '            MyFiles(FNum) = FilesInPath
    '            FilesInPath = Dir()
    '        Loop

    '        ' Set various application properties.
    '        With Application
    '            'CalcMode = .Calculation
    '            .Calculation = XlCalculation.xlCalculationManual
    '            .ScreenUpdating = False
    '            .EnableEvents = False
    '        End With

    '        ' Add a new workbook with one sheet.
    '        BaseWks = Application.Workbooks.Add(xlWBATWorksheet).Worksheets(1)
    '        rnum = 1

    '        ' Loop through all files in the myFiles array.
    '        If FNum > 0 Then
    '            For FNum = LBound(MyFiles) To UBound(MyFiles)
    '                mybook = Nothing
    '                On Error Resume Next
    '                mybook = Application.Workbooks.Open(MyPath & MyFiles(FNum))
    '                On Error GoTo 0

    '                If mybook IsNot Nothing Then
    '                    On Error Resume Next

    '                    ' Change this range to fit your own needs.
    '                    With mybook.Worksheets(1)
    '                        sourceRange = .Range("A1:C1")
    '                    End With

    '                    If Err.Number > 0 Then
    '                        Err.Clear()
    '                        sourceRange = Nothing
    '                    Else
    '                        ' If source range uses all columns then 
    '                        ' skip this file.
    '                        If sourceRange.Columns.Count >= BaseWks.Columns.Count Then
    '                            sourceRange = Nothing
    '                        End If
    '                    End If
    '                    On Error GoTo 0

    '                    If Not sourceRange Is Nothing Then

    '                        SourceRcount = sourceRange.Rows.Count

    '                        If rnum + SourceRcount >= BaseWks.Rows.Count Then
    '                            MsgBox("There are not enough rows in the target worksheet.")
    '                            BaseWks.Columns.AutoFit()
    '                            mybook.Close(SaveChanges:=False)
    '                            GoTo ExitTheSub
    '                        Else

    '                            ' Copy the file name in column A.
    '                            With sourceRange
    '                                BaseWks.Cells(rnum, "A"). _
    '                                        Resize(.Rows.Count).Value = MyFiles(FNum)
    '                            End With

    '                            ' Set the destination range.
    '                            destrange = BaseWks.Range("B" & rnum)

    '                            ' Copy the values from the source range
    '                            ' to the destination range.
    '                            With sourceRange
    '                                destrange = destrange. _
    '                                                Resize(.Rows.Count, .Columns.Count)
    '                            End With
    '                            destrange.Value = sourceRange.Value

    '                            rnum = rnum + SourceRcount
    '                        End If
    '                    End If
    '                    mybook.SaveAs(MyPath & "Return")
    '                    mybook.Close(SaveChanges:=False)
    '                End If

    '            Next FNum
    '            BaseWks.Columns.AutoFit()
    '        End If

    'ExitTheSub:
    '        ' Restore the application properties.
    '        With Application
    '            .ScreenUpdating = True
    '            .EnableEvents = True
    '            .Calculation = CalcMode
    '        End With
    '    End Sub

    'Sub MergeAllWorkbooks()
    '    Dim MyPath As String, FilesInPath As String
    '    Dim MyFiles() As String = Nothing
    '    Dim FNum As Long
    '    Dim Application As New Excel.Application
    '    Dim mybook As Workbook = Nothing
    '    Dim mySheet As Object = Nothing
    '    Dim NewWorkBook As Workbook = Nothing
    '    Dim xlWBATWorksheet As Object = System.Reflection.Missing.Value


    '    ' Change this to the path\folder location of your files.
    '    MyPath = My.Application.Info.DirectoryPath

    '    ' Add a slash at the end of the path if needed.
    '    If Right(MyPath, 1) <> "\" Then
    '        MyPath = MyPath & "\"
    '    End If

    '    ' If there are no Excel files in the folder, exit.
    '    FilesInPath = Dir(MyPath & "*.xl*")
    '    If FilesInPath = "" Then
    '        MsgBox("No files found")
    '        Exit Sub
    '    End If

    '    ' Fill the myFiles array with the list of Excel files
    '    ' in the search folder.
    '    FNum = 0
    '    Do While FilesInPath <> ""
    '        FNum = FNum + 1
    '        ReDim Preserve MyFiles(FNum)
    '        MyFiles(FNum) = FilesInPath
    '        FilesInPath = Dir()
    '    Loop

    '    ' Set various application properties.
    '    With Application
    '        'CalcMode = .Calculation
    '        .ScreenUpdating = False
    '        .EnableEvents = False
    '    End With

    '    ' Add a new workbook with one sheet.
    '    NewWorkBook = Application.Workbooks.Add(Type.Missing)
    '    'NewWorkBook.Worksheets.Add(Application.Worksheets.Add(Type.Missing))


    '    ' Loop through all files in the myFiles array.
    '    If FNum > 0 Then
    '        For FNum = LBound(MyFiles) To UBound(MyFiles)
    '            If MyFiles(FNum) IsNot Nothing Then
    '                mySheet = Nothing
    '                mySheet = Application.Workbooks.Open(MyPath & MyFiles(FNum)).Sheets(1)
    '                If mySheet IsNot Nothing Then

    '                    NewWorkBook.Sheets.Add(mySheet)
    '                    'NewWorkBook.Sheets.Add(, , 1)
    '                    NewWorkBook.Save()
    '                End If
    '                'NewWorkBook.SaveAs(MyPath & "Return")
    '                'NewWorkBook.Close(SaveChanges:=False)

    '            End If
    '        Next FNum
    '    End If
    '    With Application
    '        .ScreenUpdating = True
    '        .EnableEvents = True
    '    End With
    'End Sub

    Private Sub AddNewSheet()
        Dim xlApp As Excel.Application
        Dim xlWorkBook As Excel.Workbook
        Dim xlWorkSheet As Excel.Worksheet
        Dim misValue As Object = System.Reflection.Missing.Value
        Dim intCount As Short ' from 0 to 255 - should be sufficient. Integer would add unnecessary "space"

        xlApp = New Excel.ApplicationClass
        xlWorkBook = xlApp.Workbooks.Add(misValue)
        xlWorkSheet = xlWorkBook.Sheets("sheet1")

        ' add new worksheets & name worksheets ----------------------------
        xlApp.Range("A50:I50").EntireColumn.AutoFit()

        With xlWorkBook
            .Sheets("Sheet1").Select()
            '.Sheets("Sheet1").Name = "config"

            intCount = 1

            'use FOR Instead of While
            'Insert sheet(s) 1 - 7 ( Takoro #1 - Takoro #7 )
            For intCount = 1 To 5

                .Worksheets.Add(After:=.Worksheets(intCount)) 'INSERT AFTER LAST WORKSHEET 
                'Use counter variable properly to rename all sheets accordingly
                .Sheets(intCount).Name = "Taroko # " & intCount.ToString()
            Next

            .Worksheets.Add(Before:=.Worksheets(1)) 'Add config sheet last. BEFORE Takoro #1
            .Sheets(1).Name = "config" 'Config is now the first sheet
            xlApp.Visible = True
        End With
    End Sub
End Class
